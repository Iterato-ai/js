const IteratoService=function(){let e="",t=[],o=[],i="How was your experience?",r="We will try to do better! Would you like to share more feedback?",n=!1,a=!0,l=!0,s=0,d=3,c=6e3,p=function(){let e=document.createElement("style");e.textContent=`

                        .iterato-ai-toast {
                            position: fixed;
                            bottom: -100px;
                            left: 50%;
                            transform: translateX(-50%);
                            background-color: #1c1c1e;
                            color: #FFFFFF;
                            padding: 16px;
                            border-radius: 8px;
                            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                            z-index: 9999;
                            opacity: 0;
                            transition: opacity 0.4s ease-out, bottom 0.4s;
                            max-width: 400px;
                            width: 400px;
                            box-sizing: border-box;
                            text-align: center;
                            font-style: normal;
                            font-size: 0.95rem;
                            font-weight: 300;
                            }

                        .iterato-ai-toast button {
                            margin: 0;
                        }

                        .iterato-ai-toast p {
                            margin: 0;
                        }
                        
                        /* Typing indicator styles */
                        .typing-indicator {
                            display: inline-flex;
                            align-items: center;
                            height: 20px;
                        }
                        
                        .typing-indicator span {
                            height: 8px;
                            width: 8px;
                            background: #ededef;
                            border-radius: 50%;
                            display: inline-block;
                            margin: 0 2px;
                            opacity: 0.4;
                            animation: typing 1s infinite ease-in-out;
                        }
                        
                        .typing-indicator span:nth-child(1) {
                            animation-delay: 0s;
                        }
                        
                        .typing-indicator span:nth-child(2) {
                            animation-delay: 0.2s;
                        }
                        
                        .typing-indicator span:nth-child(3) {
                            animation-delay: 0.4s;
                        }
                        
                        @keyframes typing {
                            0% { opacity: 0.4; transform: scale(1); }
                            50% { opacity: 1; transform: scale(1.2); }
                            100% { opacity: 0.4; transform: scale(1); }
                        }

                        @media screen and (max-width: 480px) {
                            .iterato-ai-toast {
                                max-width: 96vw;
                                min-width: 96vw;
                                width: 90%;
                                left: 50%;
                                transform: translateX(-50%);
                                margin-left: 0;
                                bottom: -100px;
                                border-radius: 16px 16px 0 0;
                            }
                        }
                        
                        .iterato-ai-toast.show {
                            opacity: 1;
                            bottom: 30px;
                        }

                        @media screen and (max-width: 480px) {
                            .iterato-ai-toast.show {
                                bottom: 0;
                            }
                        }

                        .iterato-ai-toast.hide {
                            opacity: 0;
                            bottom: -100px;
                        }

                        .toast-button {
                            padding: 8px 16px;
                            margin: 0 !important;
                            background-color: #efefef;
                            color: #000;
                            border: none;
                            border-radius: 100px;
                            cursor: pointer;
                            font-size: 14px;
                            font-family: inherit;
                            font-optical-sizing: auto;
                            font-style: normal;
                            display: inline-flex;
                            align-items: center;
                            justify-content: center;
                            width: 40px;
                            height: 40px;
                            padding: 0;
                        }

                        .toast-button:hover {
                            background-color: #ededed;
                        }

                        .toast-feedback-button {
                            margin: 0 !important;
                        }
                    `,document.head.appendChild(e)},$=async function(){let o=document.getElementById("iterato-overlay");o&&(o.style.opacity="0",setTimeout(async()=>{o.parentNode&&o.parentNode.removeChild(o);try{let i=await fetch("https://iterato-api.unlink-at.workers.dev/talkwithAIPM",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project_id:window._iteratoProjectId,event_id:window._iteratoEventId,fdbk_id:e,domain:k(),conversation:t||[],need_quest:!1,user_info:window.it_setUserInfo||{}})});await i.json()}catch(r){console.log("Error sending close event:",r)}},300))},u=function(e,t,o=!1,i=!1,r=!1){let l=document.createElement("div");if(l.id=e,l.className="iterato-ai-toast",i||r){let s=document.createElement("button");s.className="toast-close-button",s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-x"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg>',s.style.position="absolute",s.style.top="8px",s.style.right="8px",s.style.background="transparent",s.style.border="none",s.style.padding="0",s.style.margin="0",s.style.cursor="pointer",s.style.color="#efefef",s.style.width="24px",s.style.height="24px",s.onclick=function(){$(),l.className="iterato-ai-toast hide",setTimeout(()=>{l.parentNode&&l.parentNode.removeChild(l)},500)},l.appendChild(s),l.style.paddingRight="36px"}let d=document.createTextNode(t);if(l.appendChild(d),i){l.appendChild(document.createElement("br"));let c=document.createElement("div");c.style.display="flex",c.style.justifyContent="center",c.style.gap="16px",c.style.marginTop="16px";let p=document.createElement("button");p.className="toast-feedback-button secondary",p.textContent="No",p.style.backgroundColor="transparent",p.style.border="0",p.style.color="#aaa",p.style.padding="8px 16px",p.style.borderRadius="4px",p.onclick=function(){l.className="iterato-ai-toast hide",setTimeout(()=>{l.parentNode&&l.parentNode.removeChild(l)},500)};let u=document.createElement("button");u.className="toast-feedback-button primary",u.textContent="Yes",u.style.backgroundColor="#ededed",u.style.border="none",u.style.color="#111",u.style.width="fit-content",u.style.padding="8px 16px",u.style.borderRadius="40px",u.onclick=function(){l.className="iterato-ai-toast hide",setTimeout(()=>{l.parentNode&&(l.parentNode.removeChild(l),f())},500)},c.appendChild(p),c.appendChild(u),l.appendChild(c)}if(r){l.appendChild(document.createElement("br"));let g=document.createElement("div");g.style.marginTop="16px";let _=document.createElement("input");_.type="text",_.placeholder="Please share your feedback...",_.style.width="calc(100% - 16px)",_.style.padding="8px",_.style.borderRadius="4px",_.style.border="none",_.style.marginBottom="16px",_.style.fontFamily="inherit",_.style.boxSizing="border-box",_.style.color="#ffffff",_.style.minWidth="0",_.disabled=!0;let m=document.createElement("button");m.textContent="Submit Feedback",m.style.backgroundColor="#28282b",m.style.border="none",m.style.color="#000",m.style.padding="8px 16px",m.style.borderRadius="4px",m.style.cursor="pointer",m.disabled=!0,m.onclick=async function(){let e=_.value;if(!e.trim())return;addUserMessage(e),_.value="",_.disabled=!0,m.disabled=!0;let t=addBotMessage(""),o=await fetchNextQuestion(e);!1===o.continueChat?(t.innerHTML="",typeWriter(t,"Thank you for sharing your feedback!",0,30,()=>{_.disabled=!1,m.disabled=!1,_.focus(),chatContainer.scrollTo({top:chatContainer.scrollHeight,behavior:"smooth"})}),setTimeout(async()=>{await $(),l.className="iterato-ai-toast hide",setTimeout(()=>{l.parentNode&&l.parentNode.removeChild(l)},500)},3e3)):o.question&&(t.innerHTML="",typeWriter(t,o.question,0,30,()=>{_.disabled=!1,m.disabled=!1,_.focus(),chatContainer.scrollTo({top:chatContainer.scrollHeight,behavior:"smooth"})}))},g.appendChild(_),g.appendChild(m),l.appendChild(g)}if(o){l.appendChild(document.createElement("br"));let b=document.createElement("div");b.style.display="flex",b.style.justifyContent="center",b.style.gap="16px",b.style.marginTop="10px";let x=document.createElement("button");x.className="toast-button",x.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="icon icon-tabler icons-tabler-filled icon-tabler-thumb-down"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M13 21.008a3 3 0 0 0 2.995 -2.823l.005 -.177v-4h2a3 3 0 0 0 2.98 -2.65l.015 -.173l.005 -.177l-.02 -.196l-1.006 -5.032c-.381 -1.625 -1.502 -2.796 -2.81 -2.78l-.164 .008h-8a1 1 0 0 0 -.993 .884l-.007 .116l.001 9.536a1 1 0 0 0 .5 .866a2.998 2.998 0 0 1 1.492 2.396l.007 .202v1a3 3 0 0 0 3 3z" /><path d="M5 14.008a1 1 0 0 0 .993 -.883l.007 -.117v-9a1 1 0 0 0 -.883 -.993l-.117 -.007h-1a2 2 0 0 0 -1.995 1.852l-.005 .15v7a2 2 0 0 0 1.85 1.994l.15 .005h1z" /></svg>',x.onclick=function(){l.className="iterato-ai-toast hide",setTimeout(()=>{l.parentNode&&l.parentNode.removeChild(l),C("negative").then(e=>{e&&200===e.statusCode&&!0===e.result?a?h():y("Thanks for your feedback!"):(console.log("Dislike! Unsuccess"),y("Thanks for your feedback!"))}).catch(e=>{console.error("Error sending feedback:",e),y("Thanks for your feedback!")})},500)};let v=document.createElement("button");v.className="toast-button",v.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="icon icon-tabler icons-tabler-filled icon-tabler-thumb-up"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M13 3a3 3 0 0 1 2.995 2.824l.005 .176v4h2a3 3 0 0 1 2.98 2.65l.015 .174l.005 .176l-.02 .196l-1.006 5.032c-.381 1.626 -1.502 2.796 -2.81 2.78l-.164 -.008h-8a1 1 0 0 1 -.993 -.883l-.007 -.117l.001 -9.536a1 1 0 0 1 .5 -.865a2.998 2.998 0 0 0 1.492 -2.397l.007 -.202v-1a3 3 0 0 1 3 -3z" /><path d="M5 10a1 1 0 0 1 .993 .883l.007 .117v9a1 1 0 0 1 -.883 .993l-.117 .007h-1a2 2 0 0 1 -1.995 -1.85l-.005 -.15v-7a2 2 0 0 1 1.85 -1.995l.15 -.005h1z" /></svg>',v.onclick=function(){l.className="iterato-ai-toast hide",setTimeout(()=>{l.parentNode&&l.parentNode.removeChild(l),C("positive").then(e=>{e&&200===e.statusCode&&!0===e.result?n?h():y("Thanks for the positive feedback!"):(console.log("Like! Unsuccess"),y("Thanks for your feedback!"))}).catch(e=>{console.error("Error sending feedback:",e),y("Thanks for your feedback!")})},500)},b.appendChild(x),b.appendChild(v),l.appendChild(b)}return document.body.appendChild(l),l},h=function(){try{let e;try{(e=document.querySelector(".iterato-ai-toast"))&&(e.className="iterato-ai-toast hide"),e&&e.parentNode&&e.parentNode.removeChild(e)}catch(t){console.error("Error removing first toast:",t)}let o="feedback-options-toast-"+Date.now(),i=u(o,r,!1,!1);i.appendChild(document.createElement("br"));let n=document.createElement("div");n.style.display="flex",n.style.justifyContent="center",n.style.gap="16px",n.style.marginTop="16px";let a=document.createElement("button");a.className="toast-feedback-button secondary",a.textContent="No",a.style.backgroundColor="transparent",a.style.border="0",a.style.color="#aaa",a.style.padding="8px 16px",a.style.width="fit-content",a.style.borderRadius="4px",a.onclick=function(){i.className="iterato-ai-toast hide",setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},500)};let l=document.createElement("button");l.className="toast-feedback-button primary",l.textContent="Yes",l.style.backgroundColor="#ededed",l.style.border="none",l.style.color="#111",l.style.width="fit-content",l.style.padding="8px 16px",l.style.borderRadius="40px",l.onclick=function(){i.className="iterato-ai-toast hide",setTimeout(()=>{i.parentNode&&(i.parentNode.removeChild(i),f())},500)},n.appendChild(a),n.appendChild(l),i.appendChild(n),T(o)}catch(s){console.error("Error in showFeedbackOptionsToast:",s),y("Thanks for your feedback!")}},f=function(){if(l){let o=document.createElement("div");o.id="iterato-overlay",o.style.position="fixed",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.height="100%",o.style.backgroundColor="rgba(0, 0, 0, 0.4)",o.style.backdropFilter="blur(3px)",o.style.WebkitBackdropFilter="blur(3px)",o.style.zIndex="9998",o.style.opacity="0",o.style.transition="opacity 0.3s ease",document.body.appendChild(o),setTimeout(()=>{o.style.opacity="1"},10)}let i="feedback-input-toast-"+Date.now(),r=u(i,"",!1,!1,!1);r.style.zIndex="9999";let n=document.createElement("div");n.style.display="flex",n.style.flexDirection="column",n.style.width="100%",n.style.maxHeight=window.innerWidth<=480?"calc(85vh - 120px)":"300px",n.style.overflowY="auto",n.style.margin="0 0 16px 0";let a=document.createElement("div");function c(e,t,o=0,i=30,r){o<t.length?(e.textContent+=t.charAt(o),o++,setTimeout(()=>c(e,t,o,i,r),i)):"function"==typeof r&&r()}async function p(o){try{if(o&&(t.push({role:"user/customer",response:o}),s++),s>=d-1){let i="Lastly! Any other insights or suggestions to help us?";return s>d-1&&(i=" Thank you for sharing the feedback!"),t.push({role:"Product Manager",question:i}),{question:i,continueChat:s<d}}let r=await fetch("https://iterato-api.unlink-at.workers.dev/talkwithAIPM",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project_id:window._iteratoProjectId,event_id:window._iteratoEventId,fdbk_id:e,domain:k(),reaction:"negative",conversation:t||[],need_quest:!0,user_info:window.it_setUserInfo||{}})}),n=await r.json();return n.question&&t.push({role:"Product Manager",question:n.question}),{...n,continueChat:s<d}}catch(a){return console.error("Error fetching next question:",a),{question:"Thank you for your feedback!",continueChat:!1}}}function h(e){let t=document.createElement("div");t.style.backgroundColor="#323232",t.style.border="1px solid #555555",t.style.borderRadius="0 8px 8px 8px",t.style.padding="8px 12px",t.style.margin="0 0 8px 0",t.style.alignSelf="flex-start",t.style.maxWidth="80%",t.style.textAlign="left",t.style.opacity="0",t.style.transform="translateY(10px) scale(0.95)",t.style.transition="opacity 0.4s ease-out, transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)";let o=document.createElement("div");return o.className="typing-indicator",o.innerHTML="<span></span><span></span><span></span>",o.style.display="inline-block",t.appendChild(o),n.appendChild(t),setTimeout(()=>{t.style.opacity="1",t.style.transform="translateY(0) scale(1)",n.scrollTop=n.scrollHeight},100),setTimeout(()=>{o.remove(),c(t,e,0,30,()=>{y.disabled=!1,g.disabled=!1,y.focus(),n.scrollTo({top:n.scrollHeight,behavior:"smooth"})});let i=setInterval(()=>{n.scrollTop=n.scrollHeight},100);setTimeout(()=>{clearInterval(i),n.scrollTop=n.scrollHeight},30*e.length+100)},800),t}a.style.backgroundColor="#28282b",a.style.border="1px solid #555555",a.style.borderRadius="0 8px 8px 8px",a.style.padding="8px 12px",a.style.margin="0 0 8px 0",a.style.alignSelf="flex-start",a.style.maxWidth="80%",a.style.textAlign="left",n.appendChild(a);let f=document.createElement("div");f.style.display="flex",f.style.flexDirection="row",f.style.alignItems="center",f.style.width="100%",f.style.gap="8px",f.style.marginBottom="8px";let y=document.createElement("input");y.type="text",y.placeholder="Type your feedback...",y.style.flex="1",y.style.padding="8px 16px",y.style.borderRadius="100px",y.style.border="none",y.style.fontFamily="inherit",y.style.boxSizing="border-box",y.style.fontSize="1rem",y.style.color="#ffffff",y.style.backgroundColor="#28282b",y.style.minWidth="0",y.disabled=!0;let g=document.createElement("button");g.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-arrow-up"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 5l0 14" /><path d="M18 11l-6 -6" /><path d="M6 11l6 -6" /></svg>',g.style.backgroundColor="#efefef",g.style.border="none",g.style.color="#111",g.style.borderRadius="100px",g.style.cursor="pointer",g.style.width="40px",g.style.height="40px",g.style.display="flex",g.style.alignItems="center",g.style.justifyContent="center",g.style.padding="0",g.style.minWidth="40px",g.disabled=!0;let _=document.createElement("button");_.textContent="Close Chat",_.style.backgroundColor="transparent",_.style.border="0",_.style.color="#616161",_.style.padding="0",_.style.borderRadius="4px",_.style.cursor="pointer",_.style.width="100%",_.style.marginTop="8px",_.style.fontWeight="400",_.onclick=function(){$(),r.className="iterato-ai-toast hide",setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r)},500)};let m=document.createElement("div");m.className="typing-indicator",m.innerHTML="<span></span><span></span><span></span>",a.appendChild(m),p().then(e=>{e.question?(a.innerHTML="",c(a,e.question,0,30,()=>{y.disabled=!1,g.disabled=!1,y.focus(),n.scrollTo({top:n.scrollHeight,behavior:"smooth"})}),setTimeout(()=>{n.scrollTop=n.scrollHeight},100)):(a.innerHTML="",c(a,"What could we have done better?",0,30,()=>{y.disabled=!1,g.disabled=!1,y.focus(),n.scrollTo({top:n.scrollHeight,behavior:"smooth"})}),setTimeout(()=>{n.scrollTop=n.scrollHeight},100))}),g.onclick=async function(){let e=y.value;if(!e.trim())return;(function e(t){let o=document.createElement("div");return o.textContent=t,o.style.backgroundColor="#efefef",o.style.border="0px",o.style.color="#000000",o.style.borderRadius="8px 8px 0 8px",o.style.padding="8px 12px",o.style.marginBottom="8px",o.style.marginTop="8px",o.style.alignSelf="flex-end",o.style.maxWidth="80%",o.style.textAlign="left",o.style.opacity="0",o.style.transform="translateY(10px) scale(0.95)",o.style.transition="opacity 0.4s ease-out, transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)",n.appendChild(o),setTimeout(()=>{o.style.opacity="1",o.style.transform="translateY(0) scale(1)",n.scrollTop=n.scrollHeight},10),o})(e),y.value="",y.disabled=!0,g.disabled=!0;let t=await p(e);if(!1===t.continueChat)h("Thank you for sharing your feedback!"),g.disabled=!0,y.disabled=!0,setTimeout(()=>{$(),r.className="iterato-ai-toast hide",setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r)},500)},3e3);else if(t.question){let o=h("");c(o,t.question,0,30,()=>{y.disabled=!1,g.disabled=!1,y.focus(),n.scrollTo({top:n.scrollHeight,behavior:"smooth"})})}},f.appendChild(y),f.appendChild(g),r.appendChild(n),r.appendChild(f),r.appendChild(_),T(i),setTimeout(()=>y.focus(),100)},y=function(e="This is the second toast notification!"){let t;try{(t=document.querySelector(".iterato-ai-toast"))&&(t.className="iterato-ai-toast hide")}catch(o){console.error("Error removing first toast:",o)}setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t);let o="second-toast-"+Date.now();u(o,e),T(o,!0)},100)},g=[],_=console.log,m=console.error,b=console.warn,x=console.debug;function v(e,t){let o=new Date,i=e=>e.toString().padStart(2,"0"),r=`${i(o.getHours())}:${i(o.getMinutes())}:${i(o.getSeconds())} GMT`,n=Array.from(t).map(e=>{if(Array.isArray(e))return JSON.stringify(e,null,2);if(e instanceof Map)return`Map(${e.size}) ${JSON.stringify(Array.from(e.entries()),null,2)}`;if(e instanceof Set)return`Set(${e.size}) ${JSON.stringify(Array.from(e.values()),null,2)}`;if("object"==typeof e&&null!==e)try{let t=new WeakSet,o=(e,o)=>{if("object"==typeof o&&null!==o){if(t.has(o))return"[Circular Reference]";t.add(o)}return o};return JSON.stringify(e,o,2)}catch(i){return"[Unserializable Object]"}return String(e)}),a="";try{let l=Error(),s=l.stack.split("\n");for(let d=2;d<s.length;d++){let c=s[d];if(!c.includes("at console.")&&!c.includes("at Object.")&&!c.includes("at HTMLDocument")){let p=c.match(/(?:at\s+|@)(?:\w+\s+\()?([^\s()]+):(\d+):(\d+)/i);if(p){let $=p[1],u=$.split("/").pop();a=`${u}:${p[2]}`;break}}}}catch(h){}return`${r} ⸺ [${e.toUpperCase()}] ${a?`[${a}]`:""} ⸺ ${n.join(" ")}`}let w=async function(){try{let e=await fetch("https://ipapi.co/json/");return await e.json()}catch(t){return console.error("Error fetching IP details:",t),{error:"Failed to fetch IP details"}}},k=function(){let e=window.location.hostname,t=e.split(".");if(t.length<2||/^\d{1,3}(\.\d{1,3}){3}$/.test(e)||"localhost"===e)return e;let o=t.slice(-2).join("."),i=t.slice(-3).join(".");return["co.uk","org.uk","gov.uk","ac.uk","com.au","net.au"].includes(o)?i:o},C=async function(t){try{let i=await w(),r={project_id:window._iteratoProjectId,event_id:window._iteratoEventId,fdbk_id:e,domain:k(),reaction:t,user_info:window.it_setUserInfo||{},conversation:{},ip_details:i,console_log:g,browser_details:window.it_browser_details,need_quest:!1,tags:o},n=await fetch("https://iterato-api.unlink-at.workers.dev/talkwithAIPM",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),a=n.status,l=await n.json();return{statusCode:a,...l,result:l.result||!1}}catch(s){return console.error("Error sending feedback to API:",s),{statusCode:500,error:"Failed to send feedback",result:!1}}},E=function(e){p();let t=document.querySelector('meta[name="viewport"]');t?t.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no":((t=document.createElement("meta")).name="viewport",t.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no",document.head.appendChild(t));try{console.log=function(...e){let t=v("log",e);g.push(t),_(t)},console.error=function(...e){let t=v("error",e);g.push(t),m(t)},console.warn=function(...e){let t=v("warn",e);g.push(t),b(t)},console.debug=function(...e){let t=v("debug",e);g.push(t),x(t)}}catch(o){console.error("Error setting up console overrides:",o)}try{window.it_browser_details={user_agent:navigator.userAgent,screen_width:window.screen.width,screen_height:window.screen.height,viewport_width:window.innerWidth,viewport_height:window.innerHeight,pixel_ratio:window.devicePixelRatio,color_depth:window.screen.colorDepth,platform:navigator.platform,language:navigator.language,cookies_enabled:navigator.cookieEnabled,online_status:navigator.onLine,browser_name:function(){let e=navigator.userAgent;if(e.indexOf("Firefox")>-1)return"Firefox";if(e.indexOf("SamsungBrowser")>-1)return"Samsung Browser";if(e.indexOf("Opera")>-1||e.indexOf("OPR")>-1)return"Opera";if(e.indexOf("Edge")>-1||e.indexOf("Edg")>-1)return"Edge";if(e.indexOf("Chrome")>-1)return"Chrome";else if(e.indexOf("Safari")>-1)return"Safari";else if(e.indexOf("MSIE")>-1||e.indexOf("Trident")>-1)return"Internet Explorer";return"Unknown"}(),is_mobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),connection_type:navigator.connection||navigator.mozConnection||navigator.webkitConnection?(navigator.connection||navigator.mozConnection||navigator.webkitConnection).effectiveType:"unknown"}}catch(i){console.log("Error creating browser details object:",i),window.it_browser_details={error:"Failed to collect browser details"}}if(!e)return Promise.resolve(!1);let r=window.location.hostname;return fetch("https://iterato-api.unlink-at.workers.dev/verifyProject",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({website_url:r,project_id:e})}).then(t=>{let o=t.status;return t.json().then(t=>200===o&&"TRUE"===t.result?(window._iteratoInitialized=!0,window._iteratoProjectId=e,console.log("IteratoService initialized successfully"),!0):(console.log("Project validation failed:",{statusCode:o,data:t}),window._iteratoInitialized=!1,!1)).catch(e=>(console.log("Error parsing validation response:",e),console.log("Project validation failed due to JSON parsing error:",{statusCode:o}),window._iteratoInitialized=!1,!1))}).catch(e=>(console.log("Error validating project (fetch failed):",e),window._iteratoInitialized=!1,!1))},T=function(e,t=!1){if(!window._iteratoInitialized)return console.error("IteratoService not initialized. Please call IteratoService.init() first."),!1;let o=document.getElementById(e);return!!o&&(o.offsetWidth,o.className="iterato-ai-toast show",t&&setTimeout(function(){o.className="iterato-ai-toast hide",$(),setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},500)},3e3),!0)},N=function(p,$={}){return p?window._iteratoInitialized&&window._iteratoProjectId?(o=[],$&&"object"==typeof $&&("tags"in $&&(Array.isArray($.tags)?o=$.tags.filter(e=>"string"==typeof e):console.warn("IteratoService: tags should be an array of strings, ignoring invalid format")),"followup_if_positive"in $&&("boolean"==typeof $.followup_if_positive?n=$.followup_if_positive:(console.warn("IteratoService: followup_if_positive should be a boolean, ignoring invalid value"),followup_if_negative=!1)),"followup_if_negative"in $&&("boolean"==typeof $.followup_if_negative?a=$.followup_if_negative:(console.warn("IteratoService: followup_if_negative should be a boolean, ignoring invalid value"),followup_if_negative=!0)),"focused_chat"in $&&("boolean"==typeof $.focused_chat?l=$.focused_chat:(console.warn("IteratoService: focused_chat should be a boolean, ignoring invalid value"),l=!1)),"initial_prompt"in $&&("string"==typeof $.initial_prompt?i=$.initial_prompt:console.warn("IteratoService: initial_prompt should be a string, ignoring invalid value")),"followup_prompt"in $&&("string"==typeof $.followup_prompt?r=$.followup_prompt:console.warn("IteratoService: followup_prompt should be a string, ignoring invalid value")),d="question_count"in $&&"number"==typeof $.question_count?Math.max(2,Math.min(7,$.question_count)):3,console.log("IteratoService: question_count set to:",d),c="first_prompt_timeout"in $&&"number"==typeof $.first_prompt_timeout?Math.max(2500,Math.min(6e4,$.first_prompt_timeout)):6e3,console.log("IteratoService: firstPromptTimeout set to:",c)),e=Date.now().toString()+Math.random().toString(36).substring(2,15),t=[],s=0,window._iteratoEventId=p,fetch("https://iterato-api.unlink-at.workers.dev/verifyEvent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event_id:p,project_id:window._iteratoProjectId})}).then(e=>{let t=e.status;return e.json().then(e=>({statusCode:t,data:e}))}).then(({statusCode:e,data:t})=>{if(200!==e||"TRUE"!==t.result)return console.error("IteratoService: Event verification failed:",{statusCode:e,data:t}),!1;{let o=document.querySelectorAll(".iterato-ai-toast");o.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)});let r="first-toast-"+Date.now();return u(r,i,!0),T(r),setTimeout(function(){let e=document.getElementById(r);e&&e.parentNode&&(e.className="iterato-ai-toast hide",setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},500))},c),!0}}).catch(e=>(console.error("IteratoService: Error verifying event:",e),!1))):(console.error("IteratoService: Service not initialized. Please call init() first"),!1):(console.error("IteratoService: Event ID is required for collect function"),!1)},I=function(e){if(!e||"object"!=typeof e||Array.isArray(e))return console.error("IteratoService: Invalid user info provided. Expected an object.",e),!1;try{return window.it_setUserInfo=e,window.it_setUserInfo,!0}catch(t){return console.error("IteratoService: Error setting user info.",t),!1}},S=function(){let e=localStorage.getItem("iterato_user_id");if(!e){let t=[navigator.userAgent,navigator.language,screen.colorDepth,screen.width+"x"+screen.height,new Date().getTimezoneOffset(),navigator.platform].join("|"),o=0;for(let i=0;i<t.length;i++){let r=t.charCodeAt(i);o=(o<<5)-o+r,o&=o}e="uid_"+Math.abs(o).toString(16)+Date.now().toString(16),localStorage.setItem("iterato_user_id",e)}return e},j=function(){try{let e=k(),t=window.location.pathname+window.location.search+window.location.hash,o=document.referrer||"",i=S();return fetch("https://iterato-api.unlink-at.workers.dev/pushPV",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({domain:e,path:t,referrer:o,user_id:i})}).then(e=>{e.ok||console.log("Failed to send page view data")}).catch(e=>{console.log("Error sending page view data:",e)}),!0}catch(r){return console.error("Error in pushPV function:",r),!1}};return{collect:N,showToast:T,init:E,setUser:I,pushPV:j}}();IteratoService.pushPV();
