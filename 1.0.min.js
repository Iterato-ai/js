const IteratoService=function(){let e="",t=0,o=[],i=[],n="How was your experience?",r="Would you like to share more feedback?",a=!1,l=!0,s=!0,d=!0,$=3,c=6e3,p="smiley",_=function(){let e=document.createElement("style");e.textContent=`

                        .iterato-ai-toast {
                            position: fixed;
                            bottom: -100px;
                            left: 50%;
                            transform: translateX(-50%);
                            background-color: #1c1c1e;
                            color: #FFFFFF;
                            padding: 16px;
                            border-radius: 8px;
                            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                            z-index: 9999;
                            opacity: 0;
                            transition: opacity 0.4s ease-out, bottom 0.4s;
                            max-width: 400px;
                            width: 400px;
                            box-sizing: border-box;
                            text-align: center;
                            font-style: normal;
                            font-size: 0.95rem;
                            font-weight: 300;
                            }

                        .iterato-ai-toast button {
                            margin: 0;
                        }

                        .iterato-ai-toast p {
                            margin: 0;
                        }
                        
                        /* Typing indicator styles */
                        .typing-indicator {
                            display: inline-flex;
                            align-items: center;
                            height: 20px;
                        }
                        
                        .typing-indicator span {
                            height: 8px;
                            width: 8px;
                            background: #ededef;
                            border-radius: 50%;
                            display: inline-block;
                            margin: 0 2px;
                            opacity: 0.4;
                            animation: typing 1s infinite ease-in-out;
                        }
                        
                        .typing-indicator span:nth-child(1) {
                            animation-delay: 0s;
                        }
                        
                        .typing-indicator span:nth-child(2) {
                            animation-delay: 0.2s;
                        }
                        
                        .typing-indicator span:nth-child(3) {
                            animation-delay: 0.4s;
                        }
                        
                        @keyframes typing {
                            0% { opacity: 0.4; transform: scale(1); }
                            50% { opacity: 1; transform: scale(1.2); }
                            100% { opacity: 0.4; transform: scale(1); }
                        }

                        @media screen and (max-width: 480px) {
                            .iterato-ai-toast {
                                max-width: 96vw;
                                min-width: 96vw;
                                width: 90%;
                                left: 50%;
                                transform: translateX(-50%);
                                margin-left: 0;
                                bottom: -100px;
                                border-radius: 16px 16px 0 0;
                            }
                        }
                        
                        .iterato-ai-toast.show {
                            opacity: 1;
                            bottom: 30px;
                        }

                        @media screen and (max-width: 480px) {
                            .iterato-ai-toast.show {
                                bottom: 0;
                            }
                        }

                        .iterato-ai-toast.hide {
                            opacity: 0;
                            bottom: -100px;
                        }

                        .toast-button {
                            padding: 8px 16px;
                            margin: 0 !important;
                            color: #000;
                            border: none;
                            border-radius: 100px;
                            cursor: pointer;
                            font-size: 14px;
                            font-family: inherit;
                            font-optical-sizing: auto;
                            font-style: normal;
                            display: inline-flex;
                            align-items: center;
                            justify-content: center;
                            width: 40px;
                            height: 40px;
                            padding: 0;
                            background-color: rgba(0,0,0,0.10);
                        }

                        .toast-button-positive{
                            color: #67BD57;
                        }

                        .toast-button-negetive{
                            color: #FF857F;
                        }

                        .toast-button-neutral{
                            color: #7FB0EF;
                        }

                        .toast-feedback-button {
                            margin: 0 !important;
                        }
                    `,document.head.appendChild(e)},u=async function(){let t=document.getElementById("iterato-overlay");t&&(t.style.opacity="0",setTimeout(async()=>{t.parentNode&&t.parentNode.removeChild(t);try{let i=await fetch("https://iterato-api.unlink-at.workers.dev/talkwithAIPM",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project_id:window._iteratoProjectId,event_id:window._iteratoEventId,fdbk_id:e,domain:E(),conversation:o||[],need_quest:!1,user_info:window.it_setUserInfo||{}})});await i.json()}catch(n){console.log("Error sending close event:",n)}},300))},h=function(e,t,o=!1,i=!1,n=!1){let r=document.createElement("div");if(r.id=e,r.className="iterato-ai-toast",i||n){let d=document.createElement("button");d.className="toast-close-button",d.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-x"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg>',d.style.position="absolute",d.style.top="8px",d.style.right="8px",d.style.background="transparent",d.style.border="none",d.style.padding="0",d.style.margin="0",d.style.cursor="pointer",d.style.color="#efefef",d.style.width="24px",d.style.height="24px",d.onclick=function(){u(),r.className="iterato-ai-toast hide",setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r)},500)},r.appendChild(d),r.style.paddingRight="36px"}let $=document.createTextNode(t);if(r.appendChild($),i){r.appendChild(document.createElement("br"));let c=document.createElement("div");c.style.display="flex",c.style.justifyContent="center",c.style.gap="16px",c.style.marginTop="16px";let _=document.createElement("button");_.className="toast-feedback-button secondary",_.textContent="No",_.style.backgroundColor="transparent",_.style.border="0",_.style.color="#aaa",_.style.padding="8px 16px",_.style.borderRadius="4px",_.onclick=function(){r.className="iterato-ai-toast hide",setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r)},500)};let h=document.createElement("button");h.className="toast-feedback-button primary",h.textContent="Yes",h.style.backgroundColor="#ededed",h.style.border="none",h.style.color="#111",h.style.width="fit-content",h.style.padding="8px 16px",h.style.borderRadius="40px",h.onclick=function(){r.className="iterato-ai-toast hide",setTimeout(()=>{r.parentNode&&(r.parentNode.removeChild(r),y())},500)},c.appendChild(_),c.appendChild(h),r.appendChild(c)}if(n){r.appendChild(document.createElement("br"));let m=document.createElement("div");m.style.marginTop="16px";let b=document.createElement("input");b.type="text",b.placeholder="Please share your feedback...",b.style.width="calc(100% - 16px)",b.style.padding="8px",b.style.borderRadius="4px",b.style.border="none",b.style.marginBottom="16px",b.style.fontFamily="inherit",b.style.boxSizing="border-box",b.style.color="#ffffff",b.style.minWidth="0",b.disabled=!0;let v=document.createElement("button");v.textContent="Submit Feedback",v.style.backgroundColor="#28282b",v.style.border="none",v.style.color="#000",v.style.padding="8px 16px",v.style.borderRadius="4px",v.style.cursor="pointer",v.disabled=!0,v.onclick=async function(){let e=b.value;if(!e.trim())return;addUserMessage(e),b.value="",b.disabled=!0,v.disabled=!0;let t=addBotMessage(""),o=await fetchNextQuestion(e);!1===o.continueChat?(t.innerHTML="",typeWriter(t,"Thank you for sharing your feedback!",0,30,()=>{b.disabled=!1,v.disabled=!1,b.focus(),chatContainer.scrollTo({top:chatContainer.scrollHeight,behavior:"smooth"})}),setTimeout(async()=>{await u(),r.className="iterato-ai-toast hide",setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r)},500)},3e3)):o.question&&(t.innerHTML="",typeWriter(t,o.question,0,30,()=>{b.disabled=!1,v.disabled=!1,b.focus(),chatContainer.scrollTo({top:chatContainer.scrollHeight,behavior:"smooth"})}))},m.appendChild(b),m.appendChild(v),r.appendChild(m)}if(o){r.appendChild(document.createElement("br"));let x=document.createElement("div");x.style.display="flex",x.style.justifyContent="center",x.style.gap="16px",x.style.marginTop="10px";let w=document.createElement("button");w.className="toast-button toast-button-negetive","smiley"===p?w.innerHTML='<svg  xmlns="http://www.w3.org/2000/svg"  width="36"  height="36"  viewBox="0 0 24 24"  fill="currentColor"  class="icon icon-tabler icons-tabler-filled icon-tabler-mood-sad"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M17 3.34a10 10 0 1 1 -14.995 8.984l-.005 -.324l.005 -.324a10 10 0 0 1 14.995 -8.336zm-5 9.86a4.5 4.5 0 0 0 -3.214 1.35a1 1 0 1 0 1.428 1.4a2.5 2.5 0 0 1 3.572 0a1 1 0 0 0 1.428 -1.4a4.5 4.5 0 0 0 -3.214 -1.35zm-2.99 -4.2l-.127 .007a1 1 0 0 0 0 1.986l.117 .007l.127 -.007a1 1 0 0 0 0 -1.986l-.117 -.007zm6 0l-.127 .007a1 1 0 0 0 0 1.986l.117 .007l.127 -.007a1 1 0 0 0 0 -1.986l-.117 -.007z" /></svg>':w.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="currentColor" class="icon icon-tabler icons-tabler-filled icon-tabler-thumb-down"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M13 21.008a3 3 0 0 0 2.995 -2.823l.005 -.177v-4h2a3 3 0 0 0 2.98 -2.65l.015 -.173l.005 -.177l-.02 -.196l-1.006 -5.032c-.381 -1.625 -1.502 -2.796 -2.81 -2.78l-.164 .008h-8a1 1 0 0 0 -.993 .884l-.007 .116l.001 9.536a1 1 0 0 0 .5 .866a2.998 2.998 0 0 1 1.492 2.396l.007 .202v1a3 3 0 0 0 3 3z" /><path d="M5 14.008a1 1 0 0 0 .993 -.883l.007 -.117v-9a1 1 0 0 0 -.883 -.993l-.117 -.007h-1a2 2 0 0 0 -1.995 1.852l-.005 .15v7a2 2 0 0 0 1.85 1.994l.15 .005h1z" /></svg>',w.onclick=function(){r.className="iterato-ai-toast hide",setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r),T("negative").then(e=>{e&&200===e.statusCode&&!0===e.result?s?f():g("Thanks for your feedback!"):(console.log("Dislike! Unsuccess"),g("Thanks for your feedback!"))}).catch(e=>{console.error("Error sending feedback:",e),g("Thanks for your feedback!")})},500)};let k=document.createElement("button");k.className="toast-button toast-button-neutral","smiley"===p?k.innerHTML='<svg  xmlns="http://www.w3.org/2000/svg"  width="36"  height="36"  viewBox="0 0 24 24"  fill="currentColor"  class="icon icon-tabler icons-tabler-filled icon-tabler-mood-smile"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M17 3.34a10 10 0 1 1 -14.995 8.984l-.005 -.324l.005 -.324a10 10 0 0 1 14.995 -8.336zm-1.8 10.946a1 1 0 0 0 -1.414 .014a2.5 2.5 0 0 1 -3.572 0a1 1 0 0 0 -1.428 1.4a4.5 4.5 0 0 0 6.428 0a1 1 0 0 0 -.014 -1.414zm-6.19 -5.286l-.127 .007a1 1 0 0 0 .117 1.993l.127 -.007a1 1 0 0 0 -.117 -1.993zm6 0l-.127 .007a1 1 0 0 0 .117 1.993l.127 -.007a1 1 0 0 0 -.117 -1.993z" /></svg>':k.innerHTML='<svg  xmlns="http://www.w3.org/2000/svg"  width="36"  height="36"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-thumb-up"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 11v8a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1v-7a1 1 0 0 1 1 -1h3a4 4 0 0 0 4 -4v-1a2 2 0 0 1 4 0v5h3a2 2 0 0 1 2 2l-1 5a2 3 0 0 1 -2 2h-7a3 3 0 0 1 -3 -3" /></svg>',k.onclick=function(){r.className="iterato-ai-toast hide",setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r),T("neutral").then(e=>{e&&200===e.statusCode&&!0===e.result?l?f():g("Thank you for the feedback!"):(console.log("Like! neutral"),g("Thank you for your feedback!"))}).catch(e=>{console.error("Error sending feedback:",e),g("Thanks for your feedback!")})},500)};let C=document.createElement("button");C.className="toast-button toast-button-positive","smiley"===p?C.innerHTML='<svg  xmlns="http://www.w3.org/2000/svg"  width="36"  height="36"  viewBox="0 0 24 24"  fill="currentColor"  class="icon icon-tabler icons-tabler-filled icon-tabler-mood-happy"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M17 3.34a10 10 0 1 1 -14.995 8.984l-.005 -.324l.005 -.324a10 10 0 0 1 14.995 -8.336zm-2 9.66h-6a1 1 0 0 0 -1 1v.05a3.975 3.975 0 0 0 3.777 3.97l.227 .005a4.026 4.026 0 0 0 3.99 -3.79l.006 -.206a1 1 0 0 0 -1 -1.029zm-5.99 -5l-.127 .007a1 1 0 0 0 .117 1.993l.127 -.007a1 1 0 0 0 -.117 -1.993zm6 0l-.127 .007a1 1 0 0 0 .117 1.993l.127 -.007a1 1 0 0 0 -.117 -1.993z" /></svg>':C.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="currentColor" class="icon icon-tabler icons-tabler-filled icon-tabler-thumb-up"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M13 3a3 3 0 0 1 2.995 2.824l.005 .176v4h2a3 3 0 0 1 2.98 2.65l.015 .174l.005 .176l-.02 .196l-1.006 5.032c-.381 1.626 -1.502 2.796 -2.81 2.78l-.164 -.008h-8a1 1 0 0 1 -.993 -.883l-.007 -.117l.001 -9.536a1 1 0 0 1 .5 -.865a2.998 2.998 0 0 0 1.492 -2.397l.007 -.202v-1a3 3 0 0 1 3 -3z" /><path d="M5 10a1 1 0 0 1 .993 .883l.007 .117v9a1 1 0 0 1 -.883 .993l-.117 .007h-1a2 2 0 0 1 -1.995 -1.85l-.005 -.15v-7a2 2 0 0 1 1.85 -1.995l.15 -.005h1z" /></svg>',C.onclick=function(){r.className="iterato-ai-toast hide",setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r),T("positive").then(e=>{e&&200===e.statusCode&&!0===e.result?a?f():g("Thanks for the positive feedback!"):(console.log("Like! Unsuccess"),g("Thanks for your feedback!"))}).catch(e=>{console.error("Error sending feedback:",e),g("Thanks for your feedback!")})},500)},x.appendChild(w),"smiley"===p&&x.appendChild(k),x.appendChild(C),r.appendChild(x)}return document.body.appendChild(r),r},f=function(){try{let e;try{(e=document.querySelector(".iterato-ai-toast"))&&(e.className="iterato-ai-toast hide"),e&&e.parentNode&&e.parentNode.removeChild(e)}catch(t){console.error("Error removing first toast:",t)}let o="feedback-options-toast-"+Date.now(),i=h(o,r,!1,!1);i.appendChild(document.createElement("br"));let n=document.createElement("div");n.style.display="flex",n.style.justifyContent="center",n.style.gap="16px",n.style.marginTop="16px";let a=document.createElement("button");a.className="toast-feedback-button secondary",a.textContent="No",a.style.backgroundColor="transparent",a.style.border="0",a.style.color="#aaa",a.style.padding="8px 16px",a.style.width="fit-content",a.style.borderRadius="4px",a.onclick=function(){i.className="iterato-ai-toast hide",setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},500)};let l=document.createElement("button");l.className="toast-feedback-button primary",l.textContent="Yes",l.style.backgroundColor="#ededed",l.style.border="none",l.style.color="#111",l.style.width="fit-content",l.style.padding="8px 16px",l.style.borderRadius="40px",l.onclick=function(){i.className="iterato-ai-toast hide",setTimeout(()=>{i.parentNode&&(i.parentNode.removeChild(i),y())},500)},n.appendChild(a),n.appendChild(l),i.appendChild(n),I(o)}catch(s){console.error("Error in showFeedbackOptionsToast:",s),g("Thanks for your feedback!")}},y=function(){if(d){let i=document.createElement("div");i.id="iterato-overlay",i.style.position="fixed",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.height="100%",i.style.backgroundColor="rgba(0, 0, 0, 0.4)",i.style.backdropFilter="blur(3px)",i.style.WebkitBackdropFilter="blur(3px)",i.style.zIndex="9998",i.style.opacity="0",i.style.transition="opacity 0.3s ease",document.body.appendChild(i),setTimeout(()=>{i.style.opacity="1"},10)}let n="feedback-input-toast-"+Date.now(),r=h(n,"",!1,!1,!1);r.style.zIndex="9999";let a=document.createElement("div");a.style.display="flex",a.style.flexDirection="column",a.style.width="100%",a.style.maxHeight=window.innerWidth<=480?"calc(85vh - 120px)":"300px",a.style.overflowY="auto",a.style.margin="0 0 16px 0";let l=document.createElement("div");function s(e,t,o=0,i=30,n){o<t.length?(e.textContent+=t.charAt(o),o++,setTimeout(()=>s(e,t,o,i,n),i)):"function"==typeof n&&n()}async function c(i){try{if(i&&(o.push({role:"user/customer",response:i}),t++),t>=$-1){let n="Lastly! Any other insights or suggestions to help us?";return t>$-1&&(n=" Thank you for sharing the feedback!"),o.push({role:"Product Manager",question:n}),{question:n,continueChat:t<$}}let r=await fetch("https://iterato-api.unlink-at.workers.dev/talkwithAIPM",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project_id:window._iteratoProjectId,event_id:window._iteratoEventId,fdbk_id:e,domain:E(),reaction_type:p,reaction:"negative",conversation:o||[],need_quest:!0,user_info:window.it_setUserInfo||{}})}),a=await r.json();return a.question&&o.push({role:"Product Manager",question:a.question}),{...a,continueChat:t<$}}catch(l){return console.error("Error fetching next question:",l),{question:"Thank you for your feedback!",continueChat:!1}}}function _(e){let t=document.createElement("div");t.style.backgroundColor="#323232",t.style.border="1px solid #555555",t.style.borderRadius="0 8px 8px 8px",t.style.padding="8px 12px",t.style.margin="0 0 8px 0",t.style.alignSelf="flex-start",t.style.maxWidth="80%",t.style.textAlign="left",t.style.opacity="0",t.style.transform="translateY(10px) scale(0.95)",t.style.transition="opacity 0.4s ease-out, transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)";let o=document.createElement("div");return o.className="typing-indicator",o.innerHTML="<span></span><span></span><span></span>",o.style.display="inline-block",t.appendChild(o),a.appendChild(t),setTimeout(()=>{t.style.opacity="1",t.style.transform="translateY(0) scale(1)",a.scrollTop=a.scrollHeight},100),setTimeout(()=>{o.remove(),s(t,e,0,30,()=>{y.disabled=!1,g.disabled=!1,y.focus(),a.scrollTo({top:a.scrollHeight,behavior:"smooth"})});let i=setInterval(()=>{a.scrollTop=a.scrollHeight},100);setTimeout(()=>{clearInterval(i),a.scrollTop=a.scrollHeight},30*e.length+100)},800),t}l.style.backgroundColor="#28282b",l.style.border="1px solid #555555",l.style.borderRadius="0 8px 8px 8px",l.style.padding="8px 12px",l.style.margin="0 0 8px 0",l.style.alignSelf="flex-start",l.style.maxWidth="80%",l.style.textAlign="left",a.appendChild(l);let f=document.createElement("div");f.style.display="flex",f.style.flexDirection="row",f.style.alignItems="center",f.style.width="100%",f.style.gap="8px",f.style.marginBottom="8px";let y=document.createElement("input");y.type="text",y.placeholder="Type your feedback...",y.style.flex="1",y.style.padding="8px 16px",y.style.borderRadius="100px",y.style.border="none",y.style.fontFamily="inherit",y.style.boxSizing="border-box",y.style.fontSize="1rem",y.style.color="#ffffff",y.style.backgroundColor="#28282b",y.style.minWidth="0",y.disabled=!0;let g=document.createElement("button");g.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-arrow-up"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 5l0 14" /><path d="M18 11l-6 -6" /><path d="M6 11l6 -6" /></svg>',g.style.backgroundColor="#efefef",g.style.border="none",g.style.color="#111",g.style.borderRadius="100px",g.style.cursor="pointer",g.style.width="40px",g.style.height="40px",g.style.display="flex",g.style.alignItems="center",g.style.justifyContent="center",g.style.padding="0",g.style.minWidth="40px",g.disabled=!0;let m=document.createElement("button");m.textContent="Close Chat",m.style.backgroundColor="transparent",m.style.border="0",m.style.color="#616161",m.style.padding="0",m.style.borderRadius="4px",m.style.cursor="pointer",m.style.width="100%",m.style.marginTop="8px",m.style.fontWeight="400",m.onclick=function(){u(),r.className="iterato-ai-toast hide",setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r)},500)};let b=document.createElement("div");b.className="typing-indicator",b.innerHTML="<span></span><span></span><span></span>",l.appendChild(b),c().then(e=>{e.question?(l.innerHTML="",s(l,e.question,0,30,()=>{y.disabled=!1,g.disabled=!1,y.focus(),a.scrollTo({top:a.scrollHeight,behavior:"smooth"})}),setTimeout(()=>{a.scrollTop=a.scrollHeight},100)):(l.innerHTML="",s(l,"What could we have done better?",0,30,()=>{y.disabled=!1,g.disabled=!1,y.focus(),a.scrollTo({top:a.scrollHeight,behavior:"smooth"})}),setTimeout(()=>{a.scrollTop=a.scrollHeight},100))}),g.onclick=async function(){let e=y.value;if(!e.trim())return;(function e(t){let o=document.createElement("div");return o.textContent=t,o.style.backgroundColor="#efefef",o.style.border="0px",o.style.color="#000000",o.style.borderRadius="8px 8px 0 8px",o.style.padding="8px 12px",o.style.marginBottom="8px",o.style.marginTop="8px",o.style.alignSelf="flex-end",o.style.maxWidth="80%",o.style.textAlign="left",o.style.opacity="0",o.style.transform="translateY(10px) scale(0.95)",o.style.transition="opacity 0.4s ease-out, transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)",a.appendChild(o),setTimeout(()=>{o.style.opacity="1",o.style.transform="translateY(0) scale(1)",a.scrollTop=a.scrollHeight},10),o})(e),y.value="",y.disabled=!0,g.disabled=!0;let t=await c(e);if(!1===t.continueChat)_("Thank you for sharing your feedback!"),g.disabled=!0,y.disabled=!0,setTimeout(()=>{u(),r.className="iterato-ai-toast hide",setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r)},500)},3e3);else if(t.question){let o=_("");s(o,t.question,0,30,()=>{y.disabled=!1,g.disabled=!1,y.focus(),a.scrollTo({top:a.scrollHeight,behavior:"smooth"})})}},f.appendChild(y),f.appendChild(g),r.appendChild(a),r.appendChild(f),r.appendChild(m),I(n),setTimeout(()=>y.focus(),100)},g=function(e="This is the second toast notification!"){let t;try{(t=document.querySelector(".iterato-ai-toast"))&&(t.className="iterato-ai-toast hide")}catch(o){console.error("Error removing first toast:",o)}setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t);let o="second-toast-"+Date.now();h(o,e),I(o,!0)},100)},m=[],b=console.log,v=console.error,x=console.warn,w=console.debug;function k(e,t){let o=new Date,i=e=>e.toString().padStart(2,"0"),n=`${i(o.getHours())}:${i(o.getMinutes())}:${i(o.getSeconds())} GMT`,r=Array.from(t).map(e=>{if(Array.isArray(e))return JSON.stringify(e,null,2);if(e instanceof Map)return`Map(${e.size}) ${JSON.stringify(Array.from(e.entries()),null,2)}`;if(e instanceof Set)return`Set(${e.size}) ${JSON.stringify(Array.from(e.values()),null,2)}`;if("object"==typeof e&&null!==e)try{let t=new WeakSet,o=(e,o)=>{if("object"==typeof o&&null!==o){if(t.has(o))return"[Circular Reference]";t.add(o)}return o};return JSON.stringify(e,o,2)}catch(i){return"[Unserializable Object]"}return String(e)}),a="";try{let l=Error(),s=l.stack.split("\n");for(let d=2;d<s.length;d++){let $=s[d];if(!$.includes("at console.")&&!$.includes("at Object.")&&!$.includes("at HTMLDocument")){let c=$.match(/(?:at\s+|@)(?:\w+\s+\()?([^\s()]+):(\d+):(\d+)/i);if(c){let p=c[1],_=p.split("/").pop();a=`${_}:${c[2]}`;break}}}}catch(u){}return`${n} ⸺ [${e.toUpperCase()}] ${a?`[${a}]`:""} ⸺ ${r.join(" ")}`}let C=async function(){try{let e=await fetch("https://ipapi.co/json/");return await e.json()}catch(t){return console.error("Error fetching IP details:",t),{error:"Failed to fetch IP details"}}},E=function(){let e=window.location.hostname,t=e.split(".");if(t.length<2||/^\d{1,3}(\.\d{1,3}){3}$/.test(e)||"localhost"===e)return e;let o=t.slice(-2).join("."),i=t.slice(-3).join(".");return["co.uk","org.uk","gov.uk","ac.uk","com.au","net.au"].includes(o)?i:o},T=async function(t){try{let o=await C(),n={project_id:window._iteratoProjectId,event_id:window._iteratoEventId,fdbk_id:e,domain:E(),reaction_type:p,reaction:t,user_info:window.it_setUserInfo||{},conversation:{},ip_details:o,console_log:m,browser_details:window.it_browser_details,need_quest:!1,tags:i},r=await fetch("https://iterato-api.unlink-at.workers.dev/talkwithAIPM",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),a=r.status,l=await r.json();return{statusCode:a,...l,result:l.result||!1}}catch(s){return console.error("Error sending feedback to API:",s),{statusCode:500,error:"Failed to send feedback",result:!1}}},N=function(e){_();let t=document.querySelector('meta[name="viewport"]');t?t.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no":((t=document.createElement("meta")).name="viewport",t.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no",document.head.appendChild(t));try{console.log=function(...e){let t=k("log",e);m.push(t),b(t)},console.error=function(...e){let t=k("error",e);m.push(t),v(t)},console.warn=function(...e){let t=k("warn",e);m.push(t),x(t)},console.debug=function(...e){let t=k("debug",e);m.push(t),w(t)}}catch(o){console.error("Error setting up console overrides:",o)}try{window.it_browser_details={user_agent:navigator.userAgent,screen_width:window.screen.width,screen_height:window.screen.height,viewport_width:window.innerWidth,viewport_height:window.innerHeight,pixel_ratio:window.devicePixelRatio,color_depth:window.screen.colorDepth,platform:navigator.platform,language:navigator.language,cookies_enabled:navigator.cookieEnabled,online_status:navigator.onLine,browser_name:function(){let e=navigator.userAgent;if(e.indexOf("Firefox")>-1)return"Firefox";if(e.indexOf("SamsungBrowser")>-1)return"Samsung Browser";if(e.indexOf("Opera")>-1||e.indexOf("OPR")>-1)return"Opera";if(e.indexOf("Edge")>-1||e.indexOf("Edg")>-1)return"Edge";if(e.indexOf("Chrome")>-1)return"Chrome";else if(e.indexOf("Safari")>-1)return"Safari";else if(e.indexOf("MSIE")>-1||e.indexOf("Trident")>-1)return"Internet Explorer";return"Unknown"}(),is_mobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),connection_type:navigator.connection||navigator.mozConnection||navigator.webkitConnection?(navigator.connection||navigator.mozConnection||navigator.webkitConnection).effectiveType:"unknown"}}catch(i){console.log("Error creating browser details object:",i),window.it_browser_details={error:"Failed to collect browser details"}}if(!e)return Promise.resolve(!1);let n=window.location.hostname;return fetch("https://iterato-api.unlink-at.workers.dev/verifyProject",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({website_url:n,project_id:e})}).then(t=>{let o=t.status;return t.json().then(t=>200===o&&"TRUE"===t.result?(window._iteratoInitialized=!0,window._iteratoProjectId=e,console.log("IteratoService initialized successfully"),!0):(console.log("Project validation failed:",{statusCode:o,data:t}),window._iteratoInitialized=!1,!1)).catch(e=>(console.log("Error parsing validation response:",e),console.log("Project validation failed due to JSON parsing error:",{statusCode:o}),window._iteratoInitialized=!1,!1))}).catch(e=>(console.log("Error validating project (fetch failed):",e),window._iteratoInitialized=!1,!1))},I=function(e,t=!1){if(!window._iteratoInitialized)return console.error("IteratoService not initialized. Please call IteratoService.init() first."),!1;let o=document.getElementById(e);return!!o&&(o.offsetWidth,o.className="iterato-ai-toast show",t&&setTimeout(function(){o.className="iterato-ai-toast hide",u(),setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},500)},3e3),!0)},S=function(_,u={}){return _?window._iteratoInitialized&&window._iteratoProjectId?(i=[],u&&"object"==typeof u&&("tags"in u&&(Array.isArray(u.tags)?i=u.tags.filter(e=>"string"==typeof e):console.warn("IteratoService: tags should be an array of strings, ignoring invalid format")),"followup_if_positive"in u&&("boolean"==typeof u.followup_if_positive?a=u.followup_if_positive:(console.warn("IteratoService: followup_if_positive should be a boolean, ignoring invalid value"),a=!1)),"followup_if_negative"in u&&("boolean"==typeof u.followup_if_negative?s=u.followup_if_negative:(console.warn("IteratoService: followup_if_negative should be a boolean, ignoring invalid value"),s=!0)),"followup_if_neutral"in u&&("boolean"==typeof u.followup_if_neutral?l=u.followup_if_neutral:(console.warn("IteratoService: followup_if_neutral should be a boolean, ignoring invalid value"),l=!0)),"focused_chat"in u&&("boolean"==typeof u.focused_chat?d=u.focused_chat:(console.warn("IteratoService: focused_chat should be a boolean, ignoring invalid value"),d=!1)),"initial_prompt"in u&&("string"==typeof u.initial_prompt?n=u.initial_prompt:console.warn("IteratoService: initial_prompt should be a string, ignoring invalid value")),"followup_prompt"in u&&("string"==typeof u.followup_prompt?r=u.followup_prompt:console.warn("IteratoService: followup_prompt should be a string, ignoring invalid value")),$="question_count"in u&&"number"==typeof u.question_count?Math.max(2,Math.min(7,u.question_count)):3,console.log("IteratoService: question_count set to:",$),c="first_prompt_timeout"in u&&"number"==typeof u.first_prompt_timeout?Math.max(2500,Math.min(6e4,u.first_prompt_timeout)):6e3,console.log("IteratoService: firstPromptTimeout set to:",c),p="reaction_type"in u&&"string"==typeof u.reaction_type&&("smiley"===u.reaction_type||"thumb"===u.reaction_type)?u.reaction_type:"smiley",console.log("IteratoService: reaction_type set to:",p)),e=Date.now().toString()+Math.random().toString(36).substring(2,15),o=[],t=0,window._iteratoEventId=_,fetch("https://iterato-api.unlink-at.workers.dev/verifyEvent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event_id:_,project_id:window._iteratoProjectId})}).then(e=>{let t=e.status;return e.json().then(e=>({statusCode:t,data:e}))}).then(({statusCode:e,data:t})=>{if(200!==e||"TRUE"!==t.result)return console.error("IteratoService: Event verification failed:",{statusCode:e,data:t}),!1;{let o=document.querySelectorAll(".iterato-ai-toast");o.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)});let i="first-toast-"+Date.now();return h(i,n,!0),I(i),setTimeout(function(){let e=document.getElementById(i);e&&e.parentNode&&(e.className="iterato-ai-toast hide",setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},500))},c),!0}}).catch(e=>(console.error("IteratoService: Error verifying event:",e),!1))):(console.error("IteratoService: Service not initialized. Please call init() first"),!1):(console.error("IteratoService: Event ID is required for collect function"),!1)},z=function(e){if(!e||"object"!=typeof e||Array.isArray(e))return console.error("IteratoService: Invalid user info provided. Expected an object.",e),!1;try{return window.it_setUserInfo=e,window.it_setUserInfo,!0}catch(t){return console.error("IteratoService: Error setting user info.",t),!1}},j=function(){let e=localStorage.getItem("iterato_user_id");if(!e){let t=[navigator.userAgent,navigator.language,screen.colorDepth,screen.width+"x"+screen.height,new Date().getTimezoneOffset(),navigator.platform].join("|"),o=0;for(let i=0;i<t.length;i++){let n=t.charCodeAt(i);o=(o<<5)-o+n,o&=o}e="uid_"+Math.abs(o).toString(16)+Date.now().toString(16),localStorage.setItem("iterato_user_id",e)}return e},M=function(){try{let e=E(),t=window.location.pathname+window.location.search+window.location.hash,o=document.referrer||"",i=j();return fetch("https://iterato-api.unlink-at.workers.dev/pushPV",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({domain:e,path:t,referrer:o,user_id:i})}).then(e=>{e.ok||console.log("Failed to send page view data")}).catch(e=>{console.log("Error sending page view data:",e)}),!0}catch(n){return console.error("Error in pushPV function:",n),!1}};return{collect:S,showToast:I,init:N,setUser:z,pushPV:M}}();IteratoService.pushPV();
