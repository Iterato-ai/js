const IteratoService=function(){let e="",t=[],o=[],n=function(){let e=document.createElement("style");e.textContent=`
                        @import url('https://fonts.googleapis.com/css2?family=Lexend+Deca:wght@100..900&display=swap');

                        .toast-notification {
                            position: fixed;
                            bottom: -100px;
                            left: 50%;
                            transform: translateX(-50%);
                            background-color: #1c1c1e;
                            color: #FFFFFF;
                            padding: 16px;
                            border-radius: 8px;
                            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                            z-index: 1000;
                            opacity: 0;
                            transition: opacity 0.4s ease-out, bottom 0.4s;
                            max-width: 400px;
                            width: 400px;
                            box-sizing: border-box;
                            text-align: center;
                            font-family: 'Lexend Deca', sans-serif;
                            font-optical-sizing: auto;
                            font-style: normal;
                            font-size: 0.95rem;
                            font-weight: 300;
                            }

                        .toast-notification button {
                            margin: 0;
                        }

                        .toast-notification p {
                            margin: 0;
                        }
                        
                        /* Typing indicator styles */
                        .typing-indicator {
                            display: inline-flex;
                            align-items: center;
                            height: 20px;
                        }
                        
                        .typing-indicator span {
                            height: 8px;
                            width: 8px;
                            background: #ededef;
                            border-radius: 50%;
                            display: inline-block;
                            margin: 0 2px;
                            opacity: 0.4;
                            animation: typing 1s infinite ease-in-out;
                        }
                        
                        .typing-indicator span:nth-child(1) {
                            animation-delay: 0s;
                        }
                        
                        .typing-indicator span:nth-child(2) {
                            animation-delay: 0.2s;
                        }
                        
                        .typing-indicator span:nth-child(3) {
                            animation-delay: 0.4s;
                        }
                        
                        @keyframes typing {
                            0% { opacity: 0.4; transform: scale(1); }
                            50% { opacity: 1; transform: scale(1.2); }
                            100% { opacity: 0.4; transform: scale(1); }
                        }

                        @media screen and (max-width: 480px) {
                            .toast-notification {
                                max-width: 96vw;
                                min-width: 96vw;
                                width: 90%;
                                left: 50%;
                                transform: translateX(-50%);
                                margin-left: 0;
                                bottom: -100px;
                                border-radius: 16px 16px 0 0;
                            }
                        }
                        
                        .toast-notification.show {
                            opacity: 1;
                            bottom: 30px;
                        }

                        @media screen and (max-width: 480px) {
                            .toast-notification.show {
                                bottom: 0;
                            }
                        }

                        .toast-notification.hide {
                            opacity: 0;
                            bottom: -100px;
                        }

                        .toast-button {
                            padding: 8px 16px;
                            margin: 0 !important;
                            background-color: #efefef;
                            color: #000;
                            border: none;
                            border-radius: 100px;
                            cursor: pointer;
                            font-size: 14px;
                            font-family: inherit;
                            font-optical-sizing: auto;
                            font-style: normal;
                            display: inline-flex;
                            align-items: center;
                            justify-content: center;
                            width: 40px;
                            height: 40px;
                            padding: 0;
                        }

                        .toast-button:hover {
                            background-color: #ededed;
                        }

                        .toast-feedback-button {
                            margin: 0 !important;
                        }
                    `,document.head.appendChild(e)},i=async function(){let o=document.getElementById("iterato-overlay");o&&(o.style.opacity="0",setTimeout(async()=>{if(o.parentNode){o.parentNode.removeChild(o),console.log("Overlay removed successfully");try{console.log("Sending FINAL DATA in api event..."),console.log(t);let n=await fetch("https://iterato-api.unlink-at.workers.dev/talkwithAIPM",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project_id:window._iteratoProjectId,event_id:window._iteratoEventId,fdbk_id:e,domain:$(),conversation:t||[],need_quest:!1,user_info:window.it_setUserInfo||{}})}),i=await n.json();console.log("API Response:",i)}catch(r){console.log("Error sending close event:",r)}}},300))},r=function(e,t,o=!1,n=!1,r=!1){let d=document.createElement("div");if(d.id=e,d.className="toast-notification",n||r){let c=document.createElement("button");c.className="toast-close-button",c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-x"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg>',c.style.position="absolute",c.style.top="8px",c.style.right="8px",c.style.background="transparent",c.style.border="none",c.style.padding="0",c.style.margin="0",c.style.cursor="pointer",c.style.color="#efefef",c.style.width="24px",c.style.height="24px",c.onclick=function(){i(),d.className="toast-notification hide",setTimeout(()=>{d.parentNode&&d.parentNode.removeChild(d)},500)},d.appendChild(c),d.style.paddingRight="36px"}let p=document.createTextNode(t);if(d.appendChild(p),n){d.appendChild(document.createElement("br"));let $=document.createElement("div");$.style.display="flex",$.style.justifyContent="center",$.style.gap="16px",$.style.marginTop="16px";let u=document.createElement("button");u.className="toast-feedback-button secondary",u.textContent="No",u.style.backgroundColor="transparent",u.style.border="0",u.style.color="#aaa",u.style.padding="8px 16px",u.style.borderRadius="4px",u.onclick=function(){d.className="toast-notification hide",setTimeout(()=>{d.parentNode&&d.parentNode.removeChild(d)},500)};let f=document.createElement("button");f.className="toast-feedback-button primary",f.textContent="Yes!",f.style.backgroundColor="#ededed",f.style.border="none",f.style.color="#111",f.style.width="fit-content",f.style.padding="8px 16px",f.style.borderRadius="40px",f.onclick=function(){d.className="toast-notification hide",setTimeout(()=>{d.parentNode&&(d.parentNode.removeChild(d),l())},500)},$.appendChild(u),$.appendChild(f),d.appendChild($)}if(r){d.appendChild(document.createElement("br"));let y=document.createElement("div");y.style.marginTop="16px";let g=document.createElement("input");g.type="text",g.placeholder="Please share your feedback...",g.style.width="calc(100% - 16px)",g.style.padding="8px",g.style.borderRadius="4px",g.style.border="none",g.style.marginBottom="16px",g.style.fontFamily="inherit",g.style.boxSizing="border-box",g.style.color="#ffffff",g.style.minWidth="0";let _=document.createElement("button");_.textContent="Submit Feedback",_.style.backgroundColor="#28282b",_.style.border="none",_.style.color="#000",_.style.padding="8px 16px",_.style.borderRadius="4px",_.style.cursor="pointer",_.onclick=async function(){let e=g.value;if(!e.trim())return;addUserMessage(e),g.value="",questionCount++;let t=addBotMessage(""),o=await fetchNextQuestion(e);!1===o.continueChat?(t.innerHTML="",typeWriter(t,"Thank you for sharing your feedback!"),g.disabled=!0,_.disabled=!0,_.style.backgroundColor="#dddddd",setTimeout(async()=>{await i(),d.className="toast-notification hide",setTimeout(()=>{d.parentNode&&d.parentNode.removeChild(d)},500)},3e3)):o.question&&(t.innerHTML="",typeWriter(t,o.question))},y.appendChild(g),y.appendChild(_),d.appendChild(y)}if(o){d.appendChild(document.createElement("br"));let m=document.createElement("div");m.style.display="flex",m.style.justifyContent="center",m.style.gap="16px",m.style.marginTop="10px";let b=document.createElement("button");b.className="toast-button",b.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="icon icon-tabler icons-tabler-filled icon-tabler-thumb-down"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M13 21.008a3 3 0 0 0 2.995 -2.823l.005 -.177v-4h2a3 3 0 0 0 2.98 -2.65l.015 -.173l.005 -.177l-.02 -.196l-1.006 -5.032c-.381 -1.625 -1.502 -2.796 -2.81 -2.78l-.164 .008h-8a1 1 0 0 0 -.993 .884l-.007 .116l.001 9.536a1 1 0 0 0 .5 .866a2.998 2.998 0 0 1 1.492 2.396l.007 .202v1a3 3 0 0 0 3 3z" /><path d="M5 14.008a1 1 0 0 0 .993 -.883l.007 -.117v-9a1 1 0 0 0 -.883 -.993l-.117 -.007h-1a2 2 0 0 0 -1.995 1.852l-.005 .15v7a2 2 0 0 0 1.85 1.994l.15 .005h1z" /></svg>',b.onclick=function(){d.className="toast-notification hide",setTimeout(()=>{d.parentNode&&d.parentNode.removeChild(d),h("negative").then(e=>{e&&200===e.statusCode&&!0===e.result?(console.log("Feedback sent successfully, Showing next feedback options"),a()):(console.log("Dislike! Unsuccess"),s("Thanks for your feedback!"))}).catch(e=>{console.error("Error sending feedback:",e),s("Thanks for your feedback!")})},500)};let x=document.createElement("button");x.className="toast-button",x.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="icon icon-tabler icons-tabler-filled icon-tabler-thumb-up"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M13 3a3 3 0 0 1 2.995 2.824l.005 .176v4h2a3 3 0 0 1 2.98 2.65l.015 .174l.005 .176l-.02 .196l-1.006 5.032c-.381 1.626 -1.502 2.796 -2.81 2.78l-.164 -.008h-8a1 1 0 0 1 -.993 -.883l-.007 -.117l.001 -9.536a1 1 0 0 1 .5 -.865a2.998 2.998 0 0 0 1.492 -2.397l.007 -.202v-1a3 3 0 0 1 3 -3z" /><path d="M5 10a1 1 0 0 1 .993 .883l.007 .117v9a1 1 0 0 1 -.883 .993l-.117 .007h-1a2 2 0 0 1 -1.995 -1.85l-.005 -.15v-7a2 2 0 0 1 1.85 -1.995l.15 -.005h1z" /></svg>',x.onclick=function(){d.className="toast-notification hide",setTimeout(()=>{d.parentNode&&d.parentNode.removeChild(d),h("positive").then(e=>{e&&200===e.statusCode&&!0===e.result?(console.log("Feedback sent successfully, Showing next feedback options"),s("Thanks for the feedback!")):(console.log("Like! Unsuccess"),s("Thanks for your feedback!"))}).catch(e=>{console.error("Error sending feedback:",e),s("Thanks for your feedback!")})},500)},m.appendChild(b),m.appendChild(x),d.appendChild(m)}return document.body.appendChild(d),d},a=function(){try{let e;try{(e=document.querySelector(".toast-notification"))&&(e.className="toast-notification hide"),e&&e.parentNode&&e.parentNode.removeChild(e)}catch(t){console.error("Error removing first toast:",t)}let o="feedback-options-toast-"+Date.now(),n=r(o,"We will try to do better! Would you like to share more feedback?",!1,!1);n.appendChild(document.createElement("br"));let i=document.createElement("div");i.style.display="flex",i.style.justifyContent="center",i.style.gap="16px",i.style.marginTop="16px";let a=document.createElement("button");a.className="toast-feedback-button secondary",a.textContent="No",a.style.backgroundColor="transparent",a.style.border="0",a.style.color="#aaa",a.style.padding="8px 16px",a.style.width="fit-content",a.style.borderRadius="4px",a.onclick=function(){n.className="toast-notification hide",setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n)},500)};let d=document.createElement("button");d.className="toast-feedback-button primary",d.textContent="Yes!",d.style.backgroundColor="#ededed",d.style.border="none",d.style.color="#111",d.style.width="fit-content",d.style.padding="8px 16px",d.style.borderRadius="40px",d.onclick=function(){n.className="toast-notification hide",setTimeout(()=>{n.parentNode&&(n.parentNode.removeChild(n),l())},500)},i.appendChild(a),i.appendChild(d),n.appendChild(i),f(o)}catch(c){console.error("Error in showFeedbackOptionsToast:",c),s("Thanks for your feedback!")}},l=function(){let o=document.createElement("div");o.id="iterato-overlay",o.style.position="fixed",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.height="100%",o.style.backgroundColor="rgba(0, 0, 0, 0.4)",o.style.backdropFilter="blur(3px)",o.style.WebkitBackdropFilter="blur(3px)",o.style.zIndex="0",o.style.opacity="0",o.style.transition="opacity 0.3s ease",document.body.appendChild(o),setTimeout(()=>{o.style.opacity="1"},10);let n="feedback-input-toast-"+Date.now(),a=r(n,"",!1,!1,!1);a.style.zIndex="2";let l=document.createElement("div");l.style.display="flex",l.style.flexDirection="column",l.style.width="100%",l.style.maxHeight=window.innerWidth<=480?"calc(85vh - 120px)":"300px",l.style.overflowY="auto",l.style.margin="0 0 16px 0";let s=document.createElement("div");function d(e,t,o=0,n=30){o<t.length&&(e.textContent+=t.charAt(o),o++,setTimeout(()=>d(e,t,o,n),n))}s.style.backgroundColor="#28282b",s.style.border="1px solid #555555",s.style.borderRadius="0 8px 8px 8px",s.style.padding="8px 12px",s.style.margin="0 0 8px 0",s.style.alignSelf="flex-start",s.style.maxWidth="80%",s.style.textAlign="left",l.appendChild(s);let c=0;async function p(o){try{if(o&&(t.push({role:"user/customer",response:o}),c++,console.log("chatHistory....",t)),console.log("Chat History:",JSON.stringify(t,null,2)),console.log("Question counter:",c),c>=3){let n="Lastly! Any other insights or suggestions to help us?";return c>3&&(n=" Thank you for sharing the feedback!"),t.push({role:"Product Manager",question:n}),{question:n,continueChat:c<4}}console.log("feedbackId:"+e);let i=await fetch("https://iterato-api.unlink-at.workers.dev/talkwithAIPM",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project_id:window._iteratoProjectId,event_id:window._iteratoEventId,fdbk_id:e,domain:$(),reaction:"negative",conversation:t||[],need_quest:!0,user_info:window.it_setUserInfo||{}})}),r=await i.json();return r.question&&t.push({role:"Product Manager",question:r.question}),{...r,continueChat:c<4}}catch(a){return console.error("Error fetching next question:",a),{question:"Thank you for your feedback!",continueChat:!1}}}function h(e){let t=document.createElement("div");t.style.backgroundColor="#323232",t.style.border="1px solid #555555",t.style.borderRadius="0 8px 8px 8px",t.style.padding="8px 12px",t.style.margin="0 0 8px 0",t.style.alignSelf="flex-start",t.style.maxWidth="80%",t.style.textAlign="left",t.style.opacity="0",t.style.transform="translateY(10px) scale(0.95)",t.style.transition="opacity 0.4s ease-out, transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)";let o=document.createElement("div");return o.className="typing-indicator",o.innerHTML="<span></span><span></span><span></span>",o.style.display="inline-block",console.log("Loading animation created for bot message"),t.appendChild(o),l.appendChild(t),setTimeout(()=>{t.style.opacity="1",t.style.transform="translateY(0) scale(1)",l.scrollTop=l.scrollHeight,console.log("Bot message with loading animation is now visible")},100),setTimeout(()=>{console.log("Removing loading animation and starting typing effect"),o.remove(),d(t,e);let n=setInterval(()=>{l.scrollTop=l.scrollHeight},100);setTimeout(()=>{clearInterval(n),l.scrollTop=l.scrollHeight,console.log("Typing effect completed for message: "+e.substring(0,20)+"...")},30*e.length+100)},800),t}let u=document.createElement("div");u.style.display="flex",u.style.flexDirection="row",u.style.alignItems="center",u.style.width="100%",u.style.gap="8px",u.style.marginBottom="8px";let y=document.createElement("input");y.type="text",y.placeholder="Type your feedback...",y.style.flex="1",y.style.padding="8px 16px",y.style.borderRadius="100px",y.style.border="none",y.style.fontFamily="inherit",y.style.boxSizing="border-box",y.style.fontSize="1rem",y.style.color="#ffffff",y.style.backgroundColor="#28282b",y.style.minWidth="0";let g=document.createElement("button");g.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-arrow-up"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 5l0 14" /><path d="M18 11l-6 -6" /><path d="M6 11l6 -6" /></svg>',g.style.backgroundColor="#efefef",g.style.border="none",g.style.color="#111",g.style.borderRadius="100px",g.style.cursor="pointer",g.style.width="40px",g.style.height="40px",g.style.display="flex",g.style.alignItems="center",g.style.justifyContent="center",g.style.padding="0",g.style.minWidth="40px";let _=document.createElement("button");_.textContent="Close Chat",_.style.backgroundColor="transparent",_.style.border="0",_.style.color="#616161",_.style.padding="0",_.style.borderRadius="4px",_.style.cursor="pointer",_.style.width="100%",_.style.marginTop="8px",_.style.fontWeight="400",_.onclick=function(){i(),a.className="toast-notification hide",setTimeout(()=>{a.parentNode&&a.parentNode.removeChild(a)},500)};let m=0,b=document.createElement("div");b.className="typing-indicator",b.innerHTML="<span></span><span></span><span></span>",s.appendChild(b),console.log("Initial loading animation added to first bot message"),p().then(e=>{e.question?(s.innerHTML="",d(s,e.question),setTimeout(()=>{l.scrollTop=l.scrollHeight},100)):(s.innerHTML="",d(s,"What could we have done better?"),setTimeout(()=>{l.scrollTop=l.scrollHeight},100))}),g.onclick=async function(){let e=y.value;if(!e.trim())return;(function e(t){let o=document.createElement("div");return o.textContent=t,o.style.backgroundColor="#efefef",o.style.border="0px",o.style.color="#000000",o.style.borderRadius="8px 8px 0 8px",o.style.padding="8px 12px",o.style.marginBottom="8px",o.style.marginTop="8px",o.style.alignSelf="flex-end",o.style.maxWidth="80%",o.style.textAlign="left",o.style.opacity="0",o.style.transform="translateY(10px) scale(0.95)",o.style.transition="opacity 0.4s ease-out, transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)",l.appendChild(o),setTimeout(()=>{o.style.opacity="1",o.style.transform="translateY(0) scale(1)",l.scrollTop=l.scrollHeight},10),o})(e),y.value="",m++;let t=await p(e);!1===t.continueChat?(h("Thank you for sharing your feedback!"),y.disabled=!0,g.disabled=!0,g.style.backgroundColor="#dddddd",setTimeout(()=>{i(),a.className="toast-notification hide",setTimeout(()=>{a.parentNode&&a.parentNode.removeChild(a)},500)},3e3)):t.question&&h(t.question)},u.appendChild(y),u.appendChild(g),a.appendChild(l),a.appendChild(u),a.appendChild(_),f(n),setTimeout(()=>y.focus(),100)},s=function(e="This is the second toast notification!"){let t;try{(t=document.querySelector(".toast-notification"))&&(t.className="toast-notification hide")}catch(o){console.error("Error removing first toast:",o)}setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t);let o="second-toast-"+Date.now();r(o,e),f(o,!0)},100)},d=console.log,c=[],p=async function(){try{let e=await fetch("https://ipapi.co/json/");return await e.json()}catch(t){return console.error("Error fetching IP details:",t),{error:"Failed to fetch IP details"}}},$=function(){let e=window.location.hostname,t=e.split(".");if(t.length<2||/^\d{1,3}(\.\d{1,3}){3}$/.test(e)||"localhost"===e)return e;let o=t.slice(-2).join("."),n=t.slice(-3).join(".");return["co.uk","org.uk","gov.uk","ac.uk","com.au","net.au"].includes(o)?n:o},h=async function(t){try{let n=await p(),i={project_id:window._iteratoProjectId,event_id:window._iteratoEventId,fdbk_id:e,domain:$(),reaction:t,user_info:window.it_setUserInfo||{},conversation:{},ip_details:n,console_log:c,browser_details:window.it_browser_details,need_quest:!1,tags:o},r=await fetch("https://iterato-api.unlink-at.workers.dev/talkwithAIPM",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),a=r.status,l=await r.json();return console.log("API response:",l),{statusCode:a,...l,result:l.result||!1}}catch(s){return console.error("Error sending feedback to API:",s),{statusCode:500,error:"Failed to send feedback",result:!1}}},u=function(e){console.log("Initializing IteratoService..."),n();let t=document.querySelector('meta[name="viewport"]');t?t.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no":((t=document.createElement("meta")).name="viewport",t.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no",document.head.appendChild(t));try{console.log=function(e){c.push(Array.from(arguments)),d.apply(console,arguments)}}catch(o){console.error("Error setting up console.log interception:",o)}try{window.it_browser_details={user_agent:navigator.userAgent,screen_width:window.screen.width,screen_height:window.screen.height,viewport_width:window.innerWidth,viewport_height:window.innerHeight,pixel_ratio:window.devicePixelRatio,color_depth:window.screen.colorDepth,platform:navigator.platform,language:navigator.language,cookies_enabled:navigator.cookieEnabled,online_status:navigator.onLine,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timezone_offset:new Date().getTimezoneOffset()+" mins",browser_name:function(){let e=navigator.userAgent;if(e.indexOf("Firefox")>-1)return"Firefox";if(e.indexOf("SamsungBrowser")>-1)return"Samsung Browser";if(e.indexOf("Opera")>-1||e.indexOf("OPR")>-1)return"Opera";if(e.indexOf("Edge")>-1||e.indexOf("Edg")>-1)return"Edge";if(e.indexOf("Chrome")>-1)return"Chrome";else if(e.indexOf("Safari")>-1)return"Safari";else if(e.indexOf("MSIE")>-1||e.indexOf("Trident")>-1)return"Internet Explorer";return"Unknown"}(),is_mobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),connection_type:navigator.connection||navigator.mozConnection||navigator.webkitConnection?(navigator.connection||navigator.mozConnection||navigator.webkitConnection).effectiveType:"unknown"}}catch(i){console.error("Error creating browser details object:",i),window.it_browser_details={error:"Failed to collect browser details"}}if(console.log(e),!e)return Promise.resolve(!1);let r=window.location.hostname;return console.log("Domain:",r),fetch("https://iterato-api.unlink-at.workers.dev/verifyProject",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({website_url:r,project_id:e})}).then(t=>{let o=t.status;return t.json().then(t=>200===o&&"TRUE"===t.result?(window._iteratoInitialized=!0,window._iteratoProjectId=e,console.log("IteratoService initialized successfully"),!0):(console.error("Project validation failed:",{statusCode:o,data:t}),window._iteratoInitialized=!1,!1)).catch(e=>(console.error("Error parsing validation response:",e),console.error("Project validation failed due to JSON parsing error:",{statusCode:o}),window._iteratoInitialized=!1,!1))}).catch(e=>(console.error("Error validating project (fetch failed):",e),window._iteratoInitialized=!1,!1))},f=function(e,t=!1){if(!window._iteratoInitialized)return console.error("IteratoService not initialized. Please call IteratoService.init() first."),!1;let o=document.getElementById(e);return!!o&&(o.offsetWidth,o.className="toast-notification show",t&&setTimeout(function(){o.className="toast-notification hide",i(),setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},500)},3e3),!0)},y=function(n,i){return n?window._iteratoInitialized&&window._iteratoProjectId?(o=[],i&&("string"==typeof i?o.push(i):Array.isArray(i)?o=o.concat(i):"object"==typeof i?Object.values(i).forEach(e=>o.push(e)):console.error("IteratoService: Tags are in unsupported format")),e=Date.now().toString()+Math.random().toString(36).substring(2,15),console.log("Feedback ID:",e),t=[],window._iteratoEventId=n,fetch("https://iterato-api.unlink-at.workers.dev/verifyEvent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event_id:n,project_id:window._iteratoProjectId})}).then(e=>{let t=e.status;return e.json().then(e=>({statusCode:t,data:e}))}).then(({statusCode:e,data:t})=>{if(200!==e||"TRUE"!==t.result)return console.error("IteratoService: Event verification failed:",{statusCode:e,data:t}),!1;{console.log("IteratoService: Event verified successfully");let o=document.querySelectorAll(".toast-notification");o.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)});let n="first-toast-"+Date.now();return r(n,"How was your experience?",!0),f(n),"undefined"!=typeof mixpanel&&mixpanel.track("Toast-1 displayed (2)"),setTimeout(function(){let e=document.getElementById(n);e&&e.parentNode&&(e.className="toast-notification hide",setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},500))},3500),!0}}).catch(e=>(console.error("IteratoService: Error verifying event:",e),!1))):(console.error("IteratoService: Service not initialized. Please call init() first"),!1):(console.error("IteratoService: Event ID is required for collect function"),!1)},g=function(e){if("object"!=typeof e||null===e)return console.error("IteratoService: Invalid user info provided. Expected an object.",e),!1;try{return window.it_setUserInfo=e,window.it_setUserInfo,!0}catch(t){return console.error("IteratoService: Error setting user info.",t),!1}},_=function(){let e=localStorage.getItem("iterato_user_id");if(!e){let t=[navigator.userAgent,navigator.language,screen.colorDepth,screen.width+"x"+screen.height,new Date().getTimezoneOffset(),navigator.platform].join("|"),o=0;for(let n=0;n<t.length;n++){let i=t.charCodeAt(n);o=(o<<5)-o+i,o&=o}e="uid_"+Math.abs(o).toString(16)+Date.now().toString(16),localStorage.setItem("iterato_user_id",e)}return e},m=function(){try{let e=$(),t=window.location.pathname+window.location.search+window.location.hash,o=document.referrer||"",n=_();return fetch("https://iterato-api.unlink-at.workers.dev/pushPV",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({domain:e,path:t,referrer:o,user_id:n})}).then(e=>{e.ok?console.log("Page view data sent successfully"):console.log("Failed to send page view data")}).catch(e=>{console.log("Error sending page view data:",e)}),!0}catch(i){return console.error("Error in pushPV function:",i),!1}};return{collect:y,showToast:f,init:u,setUser:g,pushPV:m}}();IteratoService.pushPV();
