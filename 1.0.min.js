const IteratoService=function(){let e="",t=[],o=[],n="How was your experience?",i="We will try to do better! Would you like to share more feedback?",r=!1,a=!0,l=function(){let e=document.createElement("style");e.textContent=`
                        @import url('https://fonts.googleapis.com/css2?family=Lexend+Deca:wght@100..900&display=swap');
                        .toast-notification {
                            position: fixed;
                            bottom: -100px;
                            left: 50%;
                            transform: translateX(-50%);
                            background-color: #1c1c1e;
                            color: #FFFFFF;
                            padding: 16px;
                            border-radius: 8px;
                            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                            z-index: 9999;
                            opacity: 0;
                            transition: opacity 0.4s ease-out, bottom 0.4s;
                            max-width: 400px;
                            width: 400px;
                            box-sizing: border-box;
                            text-align: center;
                            font-family: 'Lexend Deca', sans-serif;
                            font-optical-sizing: auto;
                            font-style: normal;
                            font-size: 0.95rem;
                            font-weight: 300;
                            }

                        .toast-notification button {
                            margin: 0;
                        }

                        .toast-notification p {
                            margin: 0;
                        }
                        
                        /* Typing indicator styles */
                        .typing-indicator {
                            display: inline-flex;
                            align-items: center;
                            height: 20px;
                        }
                        
                        .typing-indicator span {
                            height: 8px;
                            width: 8px;
                            background: #ededef;
                            border-radius: 50%;
                            display: inline-block;
                            margin: 0 2px;
                            opacity: 0.4;
                            animation: typing 1s infinite ease-in-out;
                        }
                        
                        .typing-indicator span:nth-child(1) {
                            animation-delay: 0s;
                        }
                        
                        .typing-indicator span:nth-child(2) {
                            animation-delay: 0.2s;
                        }
                        
                        .typing-indicator span:nth-child(3) {
                            animation-delay: 0.4s;
                        }
                        
                        @keyframes typing {
                            0% { opacity: 0.4; transform: scale(1); }
                            50% { opacity: 1; transform: scale(1.2); }
                            100% { opacity: 0.4; transform: scale(1); }
                        }

                        @media screen and (max-width: 480px) {
                            .toast-notification {
                                max-width: 96vw;
                                min-width: 96vw;
                                width: 90%;
                                left: 50%;
                                transform: translateX(-50%);
                                margin-left: 0;
                                bottom: -100px;
                                border-radius: 16px 16px 0 0;
                            }
                        }
                        
                        .toast-notification.show {
                            opacity: 1;
                            bottom: 30px;
                        }

                        @media screen and (max-width: 480px) {
                            .toast-notification.show {
                                bottom: 0;
                            }
                        }

                        .toast-notification.hide {
                            opacity: 0;
                            bottom: -100px;
                        }

                        .toast-button {
                            padding: 8px 16px;
                            margin: 0 !important;
                            background-color: #efefef;
                            color: #000;
                            border: none;
                            border-radius: 100px;
                            cursor: pointer;
                            font-size: 14px;
                            font-family: inherit;
                            font-optical-sizing: auto;
                            font-style: normal;
                            display: inline-flex;
                            align-items: center;
                            justify-content: center;
                            width: 40px;
                            height: 40px;
                            padding: 0;
                        }

                        .toast-button:hover {
                            background-color: #ededed;
                        }

                        .toast-feedback-button {
                            margin: 0 !important;
                        }
                    `,document.head.appendChild(e)},s=async function(){let o=document.getElementById("iterato-overlay");o&&(o.style.opacity="0",setTimeout(async()=>{if(o.parentNode){o.parentNode.removeChild(o),console.log("Overlay removed successfully");try{console.log("Sending FINAL DATA in api event..."),console.log(t);let n=await fetch("https://iterato-api.unlink-at.workers.dev/talkwithAIPM",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project_id:window._iteratoProjectId,event_id:window._iteratoEventId,fdbk_id:e,domain:y(),conversation:t||[],need_quest:!1,user_info:window.it_setUserInfo||{}})}),i=await n.json();console.log("API Response:",i)}catch(r){console.log("Error sending close event:",r)}}},300))},d=function(e,t,o=!1,n=!1,i=!1){let l=document.createElement("div");if(l.id=e,l.className="toast-notification",n||i){let d=document.createElement("button");d.className="toast-close-button",d.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-x"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg>',d.style.position="absolute",d.style.top="8px",d.style.right="8px",d.style.background="transparent",d.style.border="none",d.style.padding="0",d.style.margin="0",d.style.cursor="pointer",d.style.color="#efefef",d.style.width="24px",d.style.height="24px",d.onclick=function(){s(),l.className="toast-notification hide",setTimeout(()=>{l.parentNode&&l.parentNode.removeChild(l)},500)},l.appendChild(d),l.style.paddingRight="36px"}let f=document.createTextNode(t);if(l.appendChild(f),n){l.appendChild(document.createElement("br"));let u=document.createElement("div");u.style.display="flex",u.style.justifyContent="center",u.style.gap="16px",u.style.marginTop="16px";let h=document.createElement("button");h.className="toast-feedback-button secondary",h.textContent="No",h.style.backgroundColor="transparent",h.style.border="0",h.style.color="#aaa",h.style.padding="8px 16px",h.style.borderRadius="4px",h.onclick=function(){l.className="toast-notification hide",setTimeout(()=>{l.parentNode&&l.parentNode.removeChild(l)},500)};let y=document.createElement("button");y.className="toast-feedback-button primary",y.textContent="Yes",y.style.backgroundColor="#ededed",y.style.border="none",y.style.color="#111",y.style.width="fit-content",y.style.padding="8px 16px",y.style.borderRadius="40px",y.onclick=function(){l.className="toast-notification hide",setTimeout(()=>{l.parentNode&&(l.parentNode.removeChild(l),p())},500)},u.appendChild(h),u.appendChild(y),l.appendChild(u)}if(i){l.appendChild(document.createElement("br"));let _=document.createElement("div");_.style.marginTop="16px";let m=document.createElement("input");m.type="text",m.placeholder="Please share your feedback...",m.style.width="calc(100% - 16px)",m.style.padding="8px",m.style.borderRadius="4px",m.style.border="none",m.style.marginBottom="16px",m.style.fontFamily="inherit",m.style.boxSizing="border-box",m.style.color="#ffffff",m.style.minWidth="0";let b=document.createElement("button");b.textContent="Submit Feedback",b.style.backgroundColor="#28282b",b.style.border="none",b.style.color="#000",b.style.padding="8px 16px",b.style.borderRadius="4px",b.style.cursor="pointer",b.onclick=async function(){let e=m.value;if(!e.trim())return;addUserMessage(e),m.value="",questionCount++;let t=addBotMessage(""),o=await fetchNextQuestion(e);!1===o.continueChat?(t.innerHTML="",typeWriter(t,"Thank you for sharing your feedback!"),m.disabled=!0,b.disabled=!0,b.style.backgroundColor="#dddddd",setTimeout(async()=>{await s(),l.className="toast-notification hide",setTimeout(()=>{l.parentNode&&l.parentNode.removeChild(l)},500)},3e3)):o.question&&(t.innerHTML="",typeWriter(t,o.question))},_.appendChild(m),_.appendChild(b),l.appendChild(_)}if(o){l.appendChild(document.createElement("br"));let x=document.createElement("div");x.style.display="flex",x.style.justifyContent="center",x.style.gap="16px",x.style.marginTop="10px";let v=document.createElement("button");v.className="toast-button",v.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="icon icon-tabler icons-tabler-filled icon-tabler-thumb-down"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M13 21.008a3 3 0 0 0 2.995 -2.823l.005 -.177v-4h2a3 3 0 0 0 2.98 -2.65l.015 -.173l.005 -.177l-.02 -.196l-1.006 -5.032c-.381 -1.625 -1.502 -2.796 -2.81 -2.78l-.164 .008h-8a1 1 0 0 0 -.993 .884l-.007 .116l.001 9.536a1 1 0 0 0 .5 .866a2.998 2.998 0 0 1 1.492 2.396l.007 .202v1a3 3 0 0 0 3 3z" /><path d="M5 14.008a1 1 0 0 0 .993 -.883l.007 -.117v-9a1 1 0 0 0 -.883 -.993l-.117 -.007h-1a2 2 0 0 0 -1.995 1.852l-.005 .15v7a2 2 0 0 0 1.85 1.994l.15 .005h1z" /></svg>',v.onclick=function(){l.className="toast-notification hide",setTimeout(()=>{l.parentNode&&l.parentNode.removeChild(l),g("negative").then(e=>{e&&200===e.statusCode&&!0===e.result?(console.log("Feedback sent successfully, Showing next feedback options"),a?c():$("Thanks for your feedback!")):(console.log("Dislike! Unsuccess"),$("Thanks for your feedback!"))}).catch(e=>{console.error("Error sending feedback:",e),$("Thanks for your feedback!")})},500)};let w=document.createElement("button");w.className="toast-button",w.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="icon icon-tabler icons-tabler-filled icon-tabler-thumb-up"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M13 3a3 3 0 0 1 2.995 2.824l.005 .176v4h2a3 3 0 0 1 2.98 2.65l.015 .174l.005 .176l-.02 .196l-1.006 5.032c-.381 1.626 -1.502 2.796 -2.81 2.78l-.164 -.008h-8a1 1 0 0 1 -.993 -.883l-.007 -.117l.001 -9.536a1 1 0 0 1 .5 -.865a2.998 2.998 0 0 0 1.492 -2.397l.007 -.202v-1a3 3 0 0 1 3 -3z" /><path d="M5 10a1 1 0 0 1 .993 .883l.007 .117v9a1 1 0 0 1 -.883 .993l-.117 .007h-1a2 2 0 0 1 -1.995 -1.85l-.005 -.15v-7a2 2 0 0 1 1.85 -1.995l.15 -.005h1z" /></svg>',w.onclick=function(){l.className="toast-notification hide",setTimeout(()=>{l.parentNode&&l.parentNode.removeChild(l),g("positive").then(e=>{e&&200===e.statusCode&&!0===e.result?(console.log("Feedback sent successfully, Showing next feedback options"),r?c():$("Thanks for the positive feedback!")):(console.log("Like! Unsuccess"),$("Thanks for your feedback!"))}).catch(e=>{console.error("Error sending feedback:",e),$("Thanks for your feedback!")})},500)},x.appendChild(v),x.appendChild(w),l.appendChild(x)}return document.body.appendChild(l),l},c=function(){try{let e;try{(e=document.querySelector(".toast-notification"))&&(e.className="toast-notification hide"),e&&e.parentNode&&e.parentNode.removeChild(e)}catch(t){console.error("Error removing first toast:",t)}let o="feedback-options-toast-"+Date.now(),n=d(o,i,!1,!1);n.appendChild(document.createElement("br"));let r=document.createElement("div");r.style.display="flex",r.style.justifyContent="center",r.style.gap="16px",r.style.marginTop="16px";let a=document.createElement("button");a.className="toast-feedback-button secondary",a.textContent="No",a.style.backgroundColor="transparent",a.style.border="0",a.style.color="#aaa",a.style.padding="8px 16px",a.style.width="fit-content",a.style.borderRadius="4px",a.onclick=function(){n.className="toast-notification hide",setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n)},500)};let l=document.createElement("button");l.className="toast-feedback-button primary",l.textContent="Yes",l.style.backgroundColor="#ededed",l.style.border="none",l.style.color="#111",l.style.width="fit-content",l.style.padding="8px 16px",l.style.borderRadius="40px",l.onclick=function(){n.className="toast-notification hide",setTimeout(()=>{n.parentNode&&(n.parentNode.removeChild(n),p())},500)},r.appendChild(a),r.appendChild(l),n.appendChild(r),m(o)}catch(s){console.error("Error in showFeedbackOptionsToast:",s),$("Thanks for your feedback!")}},p=function(){let o=document.createElement("div");o.id="iterato-overlay",o.style.position="fixed",o.style.top="0",o.style.left="0",o.style.width="100%",o.style.height="100%",o.style.backgroundColor="rgba(0, 0, 0, 0.4)",o.style.backdropFilter="blur(3px)",o.style.WebkitBackdropFilter="blur(3px)",o.style.zIndex="9998",o.style.opacity="0",o.style.transition="opacity 0.3s ease",document.body.appendChild(o),setTimeout(()=>{o.style.opacity="1"},10);let n="feedback-input-toast-"+Date.now(),i=d(n,"",!1,!1,!1);i.style.zIndex="9999";let r=document.createElement("div");r.style.display="flex",r.style.flexDirection="column",r.style.width="100%",r.style.maxHeight=window.innerWidth<=480?"calc(85vh - 120px)":"300px",r.style.overflowY="auto",r.style.margin="0 0 16px 0";let a=document.createElement("div");function l(e,t,o=0,n=30){o<t.length&&(e.textContent+=t.charAt(o),o++,setTimeout(()=>l(e,t,o,n),n))}a.style.backgroundColor="#28282b",a.style.border="1px solid #555555",a.style.borderRadius="0 8px 8px 8px",a.style.padding="8px 12px",a.style.margin="0 0 8px 0",a.style.alignSelf="flex-start",a.style.maxWidth="80%",a.style.textAlign="left",r.appendChild(a);let c=0;async function p(o){try{if(o&&(t.push({role:"user/customer",response:o}),c++,console.log("chatHistory....",t)),console.log("Chat History:",JSON.stringify(t,null,2)),console.log("Question counter:",c),c>=3){let n="Lastly! Any other insights or suggestions to help us?";return c>3&&(n=" Thank you for sharing the feedback!"),t.push({role:"Product Manager",question:n}),{question:n,continueChat:c<4}}console.log("feedbackId:"+e);let i=await fetch("https://iterato-api.unlink-at.workers.dev/talkwithAIPM",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({project_id:window._iteratoProjectId,event_id:window._iteratoEventId,fdbk_id:e,domain:y(),reaction:"negative",conversation:t||[],need_quest:!0,user_info:window.it_setUserInfo||{}})}),r=await i.json();return r.question&&t.push({role:"Product Manager",question:r.question}),{...r,continueChat:c<4}}catch(a){return console.error("Error fetching next question:",a),{question:"Thank you for your feedback!",continueChat:!1}}}function $(e){let t=document.createElement("div");t.style.backgroundColor="#323232",t.style.border="1px solid #555555",t.style.borderRadius="0 8px 8px 8px",t.style.padding="8px 12px",t.style.margin="0 0 8px 0",t.style.alignSelf="flex-start",t.style.maxWidth="80%",t.style.textAlign="left",t.style.opacity="0",t.style.transform="translateY(10px) scale(0.95)",t.style.transition="opacity 0.4s ease-out, transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)";let o=document.createElement("div");return o.className="typing-indicator",o.innerHTML="<span></span><span></span><span></span>",o.style.display="inline-block",console.log("Loading animation created for bot message"),t.appendChild(o),r.appendChild(t),setTimeout(()=>{t.style.opacity="1",t.style.transform="translateY(0) scale(1)",r.scrollTop=r.scrollHeight,console.log("Bot message with loading animation is now visible")},100),setTimeout(()=>{console.log("Removing loading animation and starting typing effect"),o.remove(),l(t,e);let n=setInterval(()=>{r.scrollTop=r.scrollHeight},100);setTimeout(()=>{clearInterval(n),r.scrollTop=r.scrollHeight,console.log("Typing effect completed for message: "+e.substring(0,20)+"...")},30*e.length+100)},800),t}let f=document.createElement("div");f.style.display="flex",f.style.flexDirection="row",f.style.alignItems="center",f.style.width="100%",f.style.gap="8px",f.style.marginBottom="8px";let u=document.createElement("input");u.type="text",u.placeholder="Type your feedback...",u.style.flex="1",u.style.padding="8px 16px",u.style.borderRadius="100px",u.style.border="none",u.style.fontFamily="inherit",u.style.boxSizing="border-box",u.style.fontSize="1rem",u.style.color="#ffffff",u.style.backgroundColor="#28282b",u.style.minWidth="0";let h=document.createElement("button");h.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-arrow-up"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 5l0 14" /><path d="M18 11l-6 -6" /><path d="M6 11l6 -6" /></svg>',h.style.backgroundColor="#efefef",h.style.border="none",h.style.color="#111",h.style.borderRadius="100px",h.style.cursor="pointer",h.style.width="40px",h.style.height="40px",h.style.display="flex",h.style.alignItems="center",h.style.justifyContent="center",h.style.padding="0",h.style.minWidth="40px";let g=document.createElement("button");g.textContent="Close Chat",g.style.backgroundColor="transparent",g.style.border="0",g.style.color="#616161",g.style.padding="0",g.style.borderRadius="4px",g.style.cursor="pointer",g.style.width="100%",g.style.marginTop="8px",g.style.fontWeight="400",g.onclick=function(){s(),i.className="toast-notification hide",setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},500)};let _=0,b=document.createElement("div");b.className="typing-indicator",b.innerHTML="<span></span><span></span><span></span>",a.appendChild(b),console.log("Initial loading animation added to first bot message"),p().then(e=>{e.question?(a.innerHTML="",l(a,e.question),setTimeout(()=>{r.scrollTop=r.scrollHeight},100)):(a.innerHTML="",l(a,"What could we have done better?"),setTimeout(()=>{r.scrollTop=r.scrollHeight},100))}),h.onclick=async function(){let e=u.value;if(!e.trim())return;(function e(t){let o=document.createElement("div");return o.textContent=t,o.style.backgroundColor="#efefef",o.style.border="0px",o.style.color="#000000",o.style.borderRadius="8px 8px 0 8px",o.style.padding="8px 12px",o.style.marginBottom="8px",o.style.marginTop="8px",o.style.alignSelf="flex-end",o.style.maxWidth="80%",o.style.textAlign="left",o.style.opacity="0",o.style.transform="translateY(10px) scale(0.95)",o.style.transition="opacity 0.4s ease-out, transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)",r.appendChild(o),setTimeout(()=>{o.style.opacity="1",o.style.transform="translateY(0) scale(1)",r.scrollTop=r.scrollHeight},10),o})(e),u.value="",_++;let t=await p(e);!1===t.continueChat?($("Thank you for sharing your feedback!"),u.disabled=!0,h.disabled=!0,h.style.backgroundColor="#dddddd",setTimeout(()=>{s(),i.className="toast-notification hide",setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},500)},3e3)):t.question&&$(t.question)},f.appendChild(u),f.appendChild(h),i.appendChild(r),i.appendChild(f),i.appendChild(g),m(n),setTimeout(()=>u.focus(),100)},$=function(e="This is the second toast notification!"){let t;try{(t=document.querySelector(".toast-notification"))&&(t.className="toast-notification hide")}catch(o){console.error("Error removing first toast:",o)}setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t);let o="second-toast-"+Date.now();d(o,e),m(o,!0)},100)},f=console.log,u=[],h=async function(){try{let e=await fetch("https://ipapi.co/json/");return await e.json()}catch(t){return console.error("Error fetching IP details:",t),{error:"Failed to fetch IP details"}}},y=function(){let e=window.location.hostname,t=e.split(".");if(t.length<2||/^\d{1,3}(\.\d{1,3}){3}$/.test(e)||"localhost"===e)return e;let o=t.slice(-2).join("."),n=t.slice(-3).join(".");return["co.uk","org.uk","gov.uk","ac.uk","com.au","net.au"].includes(o)?n:o},g=async function(t){try{let n=await h(),i={project_id:window._iteratoProjectId,event_id:window._iteratoEventId,fdbk_id:e,domain:y(),reaction:t,user_info:window.it_setUserInfo||{},conversation:{},ip_details:n,console_log:u,browser_details:window.it_browser_details,need_quest:!1,tags:o},r=await fetch("https://iterato-api.unlink-at.workers.dev/talkwithAIPM",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),a=r.status,l=await r.json();return console.log("API response:",l),{statusCode:a,...l,result:l.result||!1}}catch(s){return console.error("Error sending feedback to API:",s),{statusCode:500,error:"Failed to send feedback",result:!1}}},_=function(e){console.log("Initializing IteratoService..."),l();let t=document.querySelector('meta[name="viewport"]');t?t.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no":((t=document.createElement("meta")).name="viewport",t.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no",document.head.appendChild(t));try{console.log=function(e){u.push(Array.from(arguments)),f.apply(console,arguments)}}catch(o){console.error("Error setting up console.log interception:",o)}try{window.it_browser_details={user_agent:navigator.userAgent,screen_width:window.screen.width,screen_height:window.screen.height,viewport_width:window.innerWidth,viewport_height:window.innerHeight,pixel_ratio:window.devicePixelRatio,color_depth:window.screen.colorDepth,platform:navigator.platform,language:navigator.language,cookies_enabled:navigator.cookieEnabled,online_status:navigator.onLine,browser_name:function(){let e=navigator.userAgent;if(e.indexOf("Firefox")>-1)return"Firefox";if(e.indexOf("SamsungBrowser")>-1)return"Samsung Browser";if(e.indexOf("Opera")>-1||e.indexOf("OPR")>-1)return"Opera";if(e.indexOf("Edge")>-1||e.indexOf("Edg")>-1)return"Edge";if(e.indexOf("Chrome")>-1)return"Chrome";else if(e.indexOf("Safari")>-1)return"Safari";else if(e.indexOf("MSIE")>-1||e.indexOf("Trident")>-1)return"Internet Explorer";return"Unknown"}(),is_mobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),connection_type:navigator.connection||navigator.mozConnection||navigator.webkitConnection?(navigator.connection||navigator.mozConnection||navigator.webkitConnection).effectiveType:"unknown"}}catch(n){console.log("Error creating browser details object:",n),window.it_browser_details={error:"Failed to collect browser details"}}if(!e)return Promise.resolve(!1);let i=window.location.hostname;return fetch("https://iterato-api.unlink-at.workers.dev/verifyProject",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({website_url:i,project_id:e})}).then(t=>{let o=t.status;return t.json().then(t=>200===o&&"TRUE"===t.result?(window._iteratoInitialized=!0,window._iteratoProjectId=e,console.log("IteratoService initialized successfully"),!0):(console.log("Project validation failed:",{statusCode:o,data:t}),window._iteratoInitialized=!1,!1)).catch(e=>(console.log("Error parsing validation response:",e),console.log("Project validation failed due to JSON parsing error:",{statusCode:o}),window._iteratoInitialized=!1,!1))}).catch(e=>(console.log("Error validating project (fetch failed):",e),window._iteratoInitialized=!1,!1))},m=function(e,t=!1){if(!window._iteratoInitialized)return console.error("IteratoService not initialized. Please call IteratoService.init() first."),!1;let o=document.getElementById(e);return!!o&&(o.offsetWidth,o.className="toast-notification show",t&&setTimeout(function(){o.className="toast-notification hide",s(),setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},500)},3e3),!0)},b=function(l,s={}){return l?window._iteratoInitialized&&window._iteratoProjectId?(o=[],s&&"object"==typeof s&&("tags"in s&&(Array.isArray(s.tags)?o=s.tags.filter(e=>"string"==typeof e):console.warn("IteratoService: tags should be an array of strings, ignoring invalid format")),"followup_if_positive"in s&&("boolean"==typeof s.followup_if_positive?r=s.followup_if_positive:console.warn("IteratoService: followup_if_positive should be a boolean, ignoring invalid value")),"followup_if_negative"in s&&("boolean"==typeof s.followup_if_negative?a=s.followup_if_negative:console.warn("IteratoService: followup_if_negative should be a boolean, ignoring invalid value")),"initial_prompt"in s&&("string"==typeof s.initial_prompt?n=s.initial_prompt:console.warn("IteratoService: initial_prompt should be a string, ignoring invalid value")),"followup_prompt"in s&&("string"==typeof s.followup_prompt?i=s.followup_prompt:console.warn("IteratoService: followup_prompt should be a string, ignoring invalid value"))),e=Date.now().toString()+Math.random().toString(36).substring(2,15),console.log("Feedback ID:",e),t=[],window._iteratoEventId=l,fetch("https://iterato-api.unlink-at.workers.dev/verifyEvent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event_id:l,project_id:window._iteratoProjectId})}).then(e=>{let t=e.status;return e.json().then(e=>({statusCode:t,data:e}))}).then(({statusCode:e,data:t})=>{if(200!==e||"TRUE"!==t.result)return console.error("IteratoService: Event verification failed:",{statusCode:e,data:t}),!1;{console.log("IteratoService: Event verified successfully");let o=document.querySelectorAll(".toast-notification");o.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)});let i="first-toast-"+Date.now();return d(i,n,!0),m(i),setTimeout(function(){let e=document.getElementById(i);e&&e.parentNode&&(e.className="toast-notification hide",setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},500))},3500),!0}}).catch(e=>(console.error("IteratoService: Error verifying event:",e),!1))):(console.error("IteratoService: Service not initialized. Please call init() first"),!1):(console.error("IteratoService: Event ID is required for collect function"),!1)},x=function(e){if(!e||"object"!=typeof e||Array.isArray(e))return console.error("IteratoService: Invalid user info provided. Expected an object.",e),!1;try{return window.it_setUserInfo=e,window.it_setUserInfo,!0}catch(t){return console.error("IteratoService: Error setting user info.",t),!1}},v=function(){let e=localStorage.getItem("iterato_user_id");if(!e){let t=[navigator.userAgent,navigator.language,screen.colorDepth,screen.width+"x"+screen.height,new Date().getTimezoneOffset(),navigator.platform].join("|"),o=0;for(let n=0;n<t.length;n++){let i=t.charCodeAt(n);o=(o<<5)-o+i,o&=o}e="uid_"+Math.abs(o).toString(16)+Date.now().toString(16),localStorage.setItem("iterato_user_id",e)}return e},w=function(){try{let e=y(),t=window.location.pathname+window.location.search+window.location.hash,o=document.referrer||"",n=v();return fetch("https://iterato-api.unlink-at.workers.dev/pushPV",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({domain:e,path:t,referrer:o,user_id:n})}).then(e=>{e.ok?console.log("Page view data sent successfully"):console.log("Failed to send page view data")}).catch(e=>{console.log("Error sending page view data:",e)}),!0}catch(i){return console.error("Error in pushPV function:",i),!1}};return{collect:b,showToast:m,init:_,setUser:x,pushPV:w}}();IteratoService.pushPV();
